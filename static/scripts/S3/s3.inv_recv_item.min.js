$(document).ready(function(){var m=$("#inv_track_item_item_id");if(m.length){var C,y=S3.supply.packs||{},g,a,d=S3.supply.binnedQuantity||0,t,I=$("#rdy-defaultbin-0"),u,z,n=$("#sub-defaultrecv_bin"),h=m.val(),p=$("#inv_inv_item_item_pack_id"),v,w,q=$("#sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_none"),J=/(\d)(?=(\d{3})+(?!\d))/g,e=$("#sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_0"),k,D,f,x,A,E,b,B=$("#inv_track_item_quantity"),F=$("#inv_track_item_req_item_id__row"),G;F.length&&F.hide();
var H=function(){z=!0;x=y[h];A={};E=x.length;p.html("");for(i=0;i<E;i++)f=x[i],A[f.i]=f.q,z?(v=f.i,k=b=f.q,selected=" selected"):selected="",z=!1,D='<option value="'+f.i+'"'+selected+">"+f.n+"</option>",p.append(D)};m.on("change.s3",function(l,r){h=m.val();r||(B.val(""),c=0,n.inlinecomponent("removeRows"),d=0);(x=y[h])?H():(C=S3.Ap.concat("/supply/item_packs.json/"+h),$.ajaxS3({url:C,dataType:"json",success:function(K){y[h]=K;H()}}))});if(h){startingItemPackID=v=p.val();var c=c?parseFloat(c):0;m.trigger("change.s3",
!0)}p.on("change.s3",function(){v=p.val();b=A[v];c=totalQuantityField.val();c=c*k/b;totalQuantityField.val(c);a=q.val();a=a*k/b;q.val(a);a=e.val();a=a*k/b;e.val(a);G=function(l){a=l.quantity.value;a=a*k/b;l.quantity.value=a;l.quantity.text=a.toString().replace(J,"$1,")};n.inlinecomponent("updateRows",G);k=b});n.on("click.s3",".inline-edt",function(){if(a=e.val())a=parseFloat(a),d-=a*b});I.click(function(){if(a=e.val())a=parseFloat(a),d+=a*b});B.change(function(){c=(c=B.val())?parseFloat(c):0});q.change(function(){if(a=
q.val())a=parseFloat(a),t=1*d/b,g=c-t,a>g&&(w="Bin Quantity reduced to Quantity remaining to be Received",u=$('<div class="alert alert-warning" style="padding-left:36px;">'+w+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),q.val(g).parent().append(u).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});e.change(function(){if(a=e.val())a=parseFloat(a),t=1*d/b,g=c-t,a>g&&(w="Bin Quantity reduced to Quantity remaining to be Received",
u=$('<div id="sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+w+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),e.val(g).parent().append(u).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});n.on("rowAdded",function(l,r){if(a=r.quantity.value)a=parseFloat(a),d+=a*b});n.on("rowRemoved",function(l,r){if(a=r.quantity.value)a=parseFloat(a),d-=
a*b})}});
