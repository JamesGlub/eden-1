$(document).ready(function(){var u=$("#inv_inv_item_item_id");if(u.length){var n,D=S3.supply.packs||{},p,a,f=S3.supply.binnedQuantity||0,g,M=$("#rdy-defaultbin-0"),q,E,v=$("#sub-defaultbin"),r=u.val(),y=$("#inv_inv_item_item_pack_id"),z,h=$("#sub_defaultbin_defaultbin_i_quantity_edit_none"),N=/(\d)(?=(\d{3})+(?!\d))/g,k=$("#sub_defaultbin_defaultbin_i_quantity_edit_0"),l,d,A,F,I,b,B=$("#inv_inv_item_site_id"),G=S3.supply.itemPackID,e=1,t=$("#inv_inv_item_quantity"),c=t.val(),C,J;if(B.length){var O=
$('a[id^="inv"].s3_add_resource_link'),P=/%5Bid%5D/g,H=B.val(),w,K=$('div[id^="sub_defaultbin_defaultbin_i_layout_id"].s3-hierarchy-widget');K.length&&B.change(function(){v.inlinecomponent("removeRows");w=B.val();n=S3.Ap.concat("/org/site/"+w+"/layout/hierarchy.tree");K.hierarchicalopts("reload",n);O.each(function(){C=$(this);n=H?C.attr("href").replace(H,w):C.attr("href").replace(P,w);C.attr("href",n)});H=w})}var L=function(m){E=!0;A=D[r];F={};I=A.length;y.html("");for(i=0;i<I;i++)d=A[i],F[d.i]=d.q,
G&&G==d.i?(z=G,l=e=b=d.q,selected=" selected"):E?(z=d.i,l=b=d.q,selected=" selected"):selected="",E=!1,opt='<option value="'+d.i+'"'+selected+">"+d.n+"</option>",y.append(opt)};u.on("change.s3",function(m,x){r=u.val();(A=D[r])?L(x):(n=S3.Ap.concat("/supply/item_packs.json/"+r),$.ajaxS3({url:n,dataType:"json",success:function(Q){D[r]=Q;L()}}))});r&&(c=c?parseFloat(c):0,u.trigger("change.s3",!0));y.on("change.s3",function(){z=y.val();b=F[z];c=t.val();c=c*l/b;t.val(c);a=h.val();a=a*l/b;h.val(a);a=k.val();
a=a*l/b;k.val(a);J=function(m){a=m.quantity.value;a=a*l/b;m.quantity.value=a;m.quantity.text=a.toString().replace(N,"$1,")};v.inlinecomponent("updateRows",J);l=b});v.on("click.s3",".inline-edt",function(){if(a=k.val())a=parseFloat(a),f-=a*b/e});M.click(function(){if(a=k.val())a=parseFloat(a),f+=a*b/e;h.change()});t.change(function(){c=(c=t.val())?parseFloat(c):0;g=f*e/b;c<g&&(message="Total Quantity reduced to Quantity in Bins",q=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+
'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(g).parent().append(q).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}));h.change()});h.change(function(){if(a=h.val())a=parseFloat(a),g=f*e/b,p=c-g,a>p&&(message="Bin Quantity reduced to Available Quantity",q=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),
h.val(p).parent().append(q).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});k.change(function(){if(a=k.val())a=parseFloat(a),g=f*e/b,p=c-g,a>p&&(message="Bin Quantity reduced to Available Quantity",q=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),k.val(p).parent().append(q).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();
return!1}))});v.on("rowAdded",function(m,x){if(a=x.quantity.value)a=parseFloat(a),f+=a*b/e});v.on("rowRemoved",function(m,x){if(a=x.quantity.value)a=parseFloat(a),f-=a*b/e})}});
