var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,f,c){if(null==d)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,f,c){if(d==Array.prototype||d==Object.prototype)return d;d[f]=c.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<d.length;++f){var c=d[f];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,f){var c=$jscomp.propertyToPolyfillSymbol[f];if(null==c)return d[f];c=d[c];return void 0!==c?c:d[f]};$jscomp.polyfill=function(d,f,c,m){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,f,c,m):$jscomp.polyfillUnisolated(d,f,c,m))};
$jscomp.polyfillUnisolated=function(d,f,c,m){c=$jscomp.global;d=d.split(".");for(m=0;m<d.length-1;m++){var b=d[m];if(!(b in c))return;c=c[b]}d=d[d.length-1];m=c[d];f=f(m);f!=m&&null!=f&&$jscomp.defineProperty(c,d,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(d,f,c,m){var b=d.split(".");d=1===b.length;m=b[0];m=!d&&m in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var a=0;a<b.length-1;a++){var e=b[a];if(!(e in m))return;m=m[e]}b=b[b.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?m[b]:null;f=f(c);null!=f&&(d?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:f}):f!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+c+"$"+b),$jscomp.defineProperty(m,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("String.prototype.startsWith",function(d){return d?d:function(f,c){var m=$jscomp.checkStringArgs(this,f,"startsWith");f+="";var b=m.length,a=f.length;c=Math.max(0,Math.min(c|0,m.length));for(var e=0;e<a&&c<b;)if(m[c++]!=f[e++])return!1;return e>=a}},"es6","es3");
(function(d){d(window.jQuery,window._,window.ol)})(function(d,f,c){var m=0;d.widget("s3.showMap",{options:{id:"default_map",i18n:{loading:"Loading",requires_login:"Requires Login"},lat:0,lon:0,zoom:0},_create:function(){this.id=m;m+=1;this.eventNamespace=".s3Map";this.proxyHost=S3.Ap.concat("/gis/proxy?url=")},_init:function(b){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},refresh:function(){var b=this.options,a=this.addLayers();this.map=b=new c.Map({layers:a,target:b.id,
view:new c.View({center:c.proj.fromLonLat([b.lon,b.lat]),zoom:b.zoom})});this.tooltip=a=d("#"+this.options.id+" .s3-gis-tooltip");a=new c.Overlay({element:a[0],positioning:"bottom-center",stopEvent:!1,offset:[0,-15]});b.addOverlay(a);this.tooltip_ol=a;this._bindEvents(b)},addLayers:function(){var b=[];this.addLayersOSM(b);this.addLayersGeoJSON(b);return b},addLayersOSM:function(b){for(var a,e,n=this.options.layers_osm||[],p,k,l,r=0;r<n.length;r++)e=n[r],a=void 0!=e.attribution?[e.attribution]:[c.source.OSM.ATTRIBUTION],
p=void 0!=e.maxZoom?e.maxZoom:19,k=void 0!=e.base?e.base:!0,l=void 0!=e.url?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",a={attributions:a,maxZoom:p,opaque:k,url:l},a=new c.layer.Tile({source:new c.source.OSM(a)}),void 0!=e._base?a.setVisible(e._base):a.setVisible(!1),b.push(a)},addLayersGeoJSON:function(b){var a=this.options,e=a.layers_feature||[],n=a.layers_geojson||[];var p=a.layers_georss||[];var k=a.layers_shapefile||[];var l=a.layers_theme||[],r=this.proxyHost;e=(a.feature_queries||
[]).concat(a.feature_resources||[]).concat(e).concat(n).concat(p).concat(k).concat(l);for(n=0;n<e.length;n++)a=e[n],k=void 0!=a.projection?new c.format.GeoJSON({dataProjection:"EPSG:"+a.projection}):new c.format.GeoJSON({dataProjection:"EPSG:4326"}),p=this.layerStyle(a),l=a.url,l.startsWith("http")&&(l=r.concat(l)),k=new c.source.Vector({url:l,format:k}),k=new c.layer.Vector({source:k,style:p}),void 0!=a.dir&&(k.dir=a.dir),void 0!=a.popup_format&&(k.s3_popup_format=a.popup_format),p=void 0!=a.type?
a.type:"feature",k.s3_layer_type=p,void 0!=a.visibility&&k.setVisible(a.visibility),b.push(k)},layerStyle:function(b){if(void 0!==b.marker)b=new c.style.Style({image:new c.style.Icon({src:S3.Ap.concat("/static/img/markers/"+b.marker.i)})});else if(void 0!==b.marker)b=b.style;else{b=new c.style.Fill({color:"rgba(255,255,255,0.4)"});var a=new c.style.Stroke({color:"#3399CC",width:1.25}),e=new c.style.Icon({src:S3.Ap.concat("/static/img/markers/"+this.options.marker)}),n={Point:new c.style.Style({image:e}),
LineString:new c.style.Style({stroke:a}),MultiLineString:new c.style.Style({stroke:a}),MultiPoint:new c.style.Style({image:e}),MultiPolygon:new c.style.Style({stroke:a,fill:b}),Polygon:new c.style.Style({stroke:a,fill:b}),GeometryCollection:new c.style.Style({stroke:a,fill:b,image:e}),Circle:new c.style.Style({stroke:a,fill:b})};b=function(p){return n[p.getGeometry().getType()]}}return b},addPopup:function(b,a,e,n,p){var k=this.map;a=this.id+"_"+a.ol_uid+"_"+b.get("id")+"_popup";p&&e?(0===e.indexOf("http")&&
(e=this.proxyHost+encodeURIComponent(e)),n='<iframe src="'+e+'" onload="S3.gis.popupLoaded(\''+a+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>'):void 0==n&&(n=this.options.i18n.loading+'...<div class="throbber"></div>');d("#"+this.options.id).append('<div id="'+a+'" class="s3-gis-popup"><div class="s3-gis-popup-close"></div><div class="s3-gis-popup-content"></div></div>');var l=d("#"+a),r=new c.Overlay({element:l[0],positioning:"bottom-center",offset:[0,-12]});k.addOverlay(r);
b=b.getGeometry().getCoordinates();r.setPosition(b);d("#"+a+" .s3-gis-popup-content").html(n);l.show();d("#"+a+" .s3-gis-popup-close").on("click",{id:a,map:k,overlay:r},this.removePopup);p||void 0==e||this._loadDetails(e,a,l)},removePopup:function(b){b.data.map.removeOverlay(b.data.overlay);d("#"+b.data.id).remove();b.preventDefault()},_loadDetails:function(b,a,e){var n=this;0===b.indexOf("http")&&(b=this.proxyHost+encodeURIComponent(b));d.ajaxS3({url:b,dataType:"html",success:function(p){try{d("#"+
a+" .s3-gis-popup-content").html(p),d("#"+a+" a.btn.iframe").click(function(){var k=d(this).attr("href");0===k.indexOf("http://")&&(k=n.proxyHost+encodeURIComponent(k));k='<iframe src="'+k+'" onload="S3.gis.popupLoaded(\''+a+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>';d("#"+a+" .s3-gis-popup-content").html(k);return!1})}catch(k){}},error:function(p,k,l){msg="UNAUTHORIZED"==l?n.options.i18n.requires_login:p.responseText;d("#"+a+" .s3-gis-popup-content").html(msg)}})},
_deserialize:function(){},_bindEvents:function(b){var a=this,e,n,p,k,l,r,D,B,E,q,F,z,G;b.on("pointermove",function(g){if(g.dragging)a.tooltip.hide();else if(z=b.forEachFeatureAtPixel(g.pixel,function(h,t){return{feature:h,layer:t}})){l=z.feature;q=z.layer;r=l.getGeometry();D=r.getType();if("Point"==D)p=r.getCoordinates();else if("Polygon"==D)p=r.getInteriorPoint().getCoordinates();else throw"No support yet for Popups other than for Points or Polygons!";a.tooltip_ol.setPosition(p);if(void 0!=q.s3_popup_format){f.templateSettings=
{interpolate:/\{(.+?)\}/g};F=q.s3_popup_format;G=f.template(F);e={};k={};E=F.split("{");for(g=0;g<E.length;g++)B=E[g].split("}")[0],e[B]=l.get(B),k[B]="";f.defaults(e,k);n=G(e)}else void 0!=l.get("popup")?n=l.get("popup"):void 0!=l.get("name")?n=l.get("name"):void 0!=q.title&&(g=l.get(q.title),n="object"==typeof g?g.value:g);a.tooltip.html(n).show()}else a.tooltip.hide()});b.on("click",function(g){if(z=b.forEachFeatureAtPixel(g.pixel,function(x,u){return{feature:x,layer:u}})){a.tooltip.hide();l=z.feature;
q=z.layer;var h=l.getProperties();g=q.s3_layer_type;if("kml"==g){g=void 0!=q.title?q.title:"name";if(void 0!=l.style.balloonStyle)var t=l.style.balloonStyle.replace(/{([^{}]*)}/g,function(x,u){u=h[u];return"string"===typeof u||"number"===typeof u?u:x});else{var v=typeof h[g];g="object"==v?h[g].value:h[g];t="<h3>"+g+"</h3>";g=q.body.split(" ");for(var y,C,w=0;w<g.length;w++)v=typeof h[g[w]],"object"==v?(v=h[g[w]].displayName,""===v&&(v=g[w]),C=h[g[w]].value,y='<div class="gis_popup_row"><div class="gis_popup_label">'+
v+':</div><div class="gis_popup_cell">'+C+"</div></div>"):y=void 0!=h[g[w]]?'<div class="gis_popup_row">'+h[g[w]]+"</div>":"",t+=y}-1!=t.search("<script")&&(t="Content contained Javascript! Escaped content below.<br />"+t.replace(/</g,"<"))}else if("gpx"!=g)if("shapefile"==g||"geojson"==g)t="<div>",d.each(h,function(x,u){"id_orig"==x&&(x="id");y='<div class="gis_popup_row"><div class="gis_popup_label">'+x+':</div><div class="gis_popup_cell">'+u+"</div></div>";t+=y}),t+="</div>";else if("wfs"==g)g=
void 0!=q.title?q.title:"name",g=h[g],t="<h3>"+g+"</h3>",d.each(h,function(x,u){y='<div class="gis_popup_row"><div class="gis_popup_label">'+x+':</div><div class="gis_popup_val">'+u+"</div></div>";t+=y});else if(void 0!=h.url)var A=h.url;else if(void 0!=q.s3_url_format)f.templateSettings={interpolate:/\{(.+?)\}/g},A=f.template(q.s3_url_format),h.id.constructor===Array&&(h.id=h.id[0]),A=A(h);else{name=void 0==h.name?"":"<h3>"+h.name+"</h3>";g=void 0==h.description?"":"<p>"+h.description+"</p>";w=void 0==
h.link?"":'<a href="'+h.link+'" target="_blank">'+h.link+"</a>";if(void 0==h.data)v="";else if(0===h.data.indexOf("http://")){var I=!0;var H=S3.uid();v='<div id="'+H+'">'+a.options.i18n.loading+"...<div class='throbber'></div></div>"}else v="<p>"+h.data+"</p>";C=void 0==h.image?"":0===h.image.indexOf("http://")?'<img src="'+h.image+'" height=300 width=300>':"";t=name+g+w+v+C}A=a.addPopup(l,q,A,t);I&&a._loadDetails(h.data,H,A)}})},_unbindEvents:function(){return!0}})});
