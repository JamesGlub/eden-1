$(document).ready(function(){var u=$("#inv_track_item_send_inv_item_id");if(u.length){var k=$("#inv_track_item_item_pack_id"),g=$("#inv_track_item_quantity"),E=$("#inv_track_item_req_item_id__row"),w=u.val(),m;E.length&&E.hide();u.on("change.s3",function(f,x){var q=u.val(),K;k.html("");x||g.val("");$("#TotalQuantity").remove();if(""!==q){f=$(this).attr("id");try{S3.JSONRequest[f].abort()}catch(a){}x=S3.supply.inv_items;if(void 0===x){0===$("#item_pack_throbber").length&&k.after('<div id="item_pack-throbber" class="throbber"/>');
var v=S3.Ap.concat("/inv/inv_item_quantity.json/"+q);S3.JSONRequest[f]=$.getJSON(v,function(a){var d,n=a.quantity,y=a.packs,z=y.length;a=!0;for(d=0;d<z;d++){var c=y[d];if(1==c.quantity){var F=c.name;break}}for(d=0;d<z;d++){c=y[d];G&&w==q&&G==c.id&&(K=c.quantity);if(a){var A=c.quantity;var H=c.name;a=" selected"}else a="";a=1!==c.quantity?'<option value="'+c.id+'"'+a+">"+c.name+" ("+c.quantity+" x "+F+")</option>":'<option value="'+c.id+'"'+a+">"+c.name+"</option>";k.append(a);a=!1}$("#item_pack-throbber").remove();
var p=n/A;m&&w==q&&(p+=m);F='<span id="TotalQuantity"> / '+p.toFixed(2)+" "+H+" ("+i18n.in_inv+")</span>";g.after(F);if(1<z){var I;k.on("change",function(){I=parseInt(k.val());for(d=0;d<z;d++)if(c=y[d],c.id==I){A=c.quantity;H=c.name;p=n/A;m&&w==q&&(p=G==I?p+m:p+m*K/A);$("#TotalQuantity").html(p.toFixed(2)+" "+H+" ("+i18n.in_inv+")");break}})}})}else{var b,B=!0;f=x[q];var C=f.packs,D=C.length,r=f.req_items,h=r[0],L=h.inv_quantity;for(b=0;b<D;b++){var e=C[b];if(1==e.quantity){v=e.name;break}}for(b=
0;b<D;b++){e=C[b];if(B){var t=e.quantity;var J=e.name;f=" selected"}else f="";f=1!==e.quantity?'<option value="'+e.id+'"'+f+">"+e.name+" ("+e.quantity+" x "+v+")</option>":'<option value="'+e.id+'"'+f+">"+e.name+"</option>";k.append(f);B=!1}var l=L/t;v='<span id="TotalQuantity"> / '+l.toFixed(2)+" "+J+" ("+i18n.in_inv+")</span>";g.after(v);var M=function(){if(1==r.length){var a=h.req_quantity/t;a<=l?g.val(a):g.val(l);$("#inv_track_item_req_item_id").val(h.req_item_id)}else{E.show();var d,n=$("#inv_track_item_req_item_id");
n.html("");for(b=0;b<r.length;b++)h=r[b],n.append(new Option(h.req_ref,h.req_item_id)),B&&(a=h.req_quantity/t,a<=l?g.val(a):g.val(l)),B=!1;n.on("change",function(){d=parseInt(n.val());for(b=0;b<r.length;b++)if(h=r[b],h.req_item_id==d){a=h.req_quantity/t;a<=l?g.val(a):g.val(l);break}})}};M();if(1<D){var N;k.on("change",function(){N=parseInt(k.val());for(b=0;b<D;b++)if(e=C[b],e.id==N){t=e.quantity;J=e.name;l=L/t;$("#TotalQuantity").html(l.toFixed(2)+" "+J+" ("+i18n.in_inv+")");M();break}})}}}});if(w){(m=
g.val())&&(m=parseFloat(m));var G=parseInt(k.val());u.trigger("change.s3",!0)}}});
