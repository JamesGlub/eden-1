/*
 2013-2021 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2015-2021 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
 jsTree 3.3.12 + bugfix: https://github.com/vakata/jstree/commit/f40579c6601babd250b0df72ccf63e8de064110c
 http://jstree.com/

 Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)

 Licensed same as jquery - under the terms of the MIT License
   http://www.opensource.org/licenses/mit-license.php
 if using jslint please allow for the jQuery global and use following options:
 jslint: loopfunc: true, browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 'themes' : {
      'name' : this.get_theme(),
      'icons' : this._data.core.themes.icons,
      'dots' : this._data.core.themes.dots
     },
 oi = obj.children("i:visible"),
   ai = a.children("i:visible"),
   w1 = oi.width() * oi.length,
   w2 = ai.width() * ai.length,
 "shortcut"			: 113,
     "shortcut_label"	: 'F2',
     "icon"				: "glyphicon glyphicon-leaf",
 if(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {
    var el = null, tm = null;
    this.element
     .on("touchstart", ".jstree-anchor", function (e) {
      el = e.currentTarget;
      tm = +new Date();
      $(document).one("touchend", function (e) {
       e.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);
       e.currentTarget = e.target;
       tm = ((+(new Date())) - tm);
       if(e.target === el && tm > 600 && tm < 1000) {
        e.preventDefault();
        $(el).trigger('contextmenu', e);
       }
       el = null;
       tm = null;
      });
     });
   }
 .on("mousedown.jstree touchstart.jstree", ".jstree-wholerow", function (e) {
      if(e.target === e.currentTarget) {
       var a = $(e.currentTarget).closest(".jstree-node").children(".jstree-anchor");
       e.target = a[0];
       a.trigger(e);
      }
     })
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(f){var z=0;return function(){return z<f.length?{done:!1,value:f[z++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.makeIterator=function(f){var z="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return z?z.call(f):$jscomp.arrayIterator(f)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var z=0;z<f.length;++z){var F=f[z];if(F&&F.Math==Math)return F}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,z,F){if(f==Array.prototype||f==Object.prototype)return f;f[z]=F.value;return f};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";
var $jscomp$lookupPolyfilledValue=function(f,z){var F=$jscomp.propertyToPolyfillSymbol[z];if(null==F)return f[z];F=f[F];return void 0!==F?F:f[z]};$jscomp.polyfill=function(f,z,F,q){z&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,z,F,q):$jscomp.polyfillUnisolated(f,z,F,q))};
$jscomp.polyfillUnisolated=function(f,z,F,q){F=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var r=f[q];if(!(r in F))return;F=F[r]}f=f[f.length-1];q=F[f];z=z(q);z!=q&&null!=z&&$jscomp.defineProperty(F,f,{configurable:!0,writable:!0,value:z})};
$jscomp.polyfillIsolated=function(f,z,F,q){var r=f.split(".");f=1===r.length;q=r[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var A=0;A<r.length-1;A++){var w=r[A];if(!(w in q))return;q=q[w]}r=r[r.length-1];F=$jscomp.IS_SYMBOL_NATIVE&&"es6"===F?q[r]:null;z=z(F);null!=z&&(f?$jscomp.defineProperty($jscomp.polyfills,r,{configurable:!0,writable:!0,value:z}):z!==F&&(void 0===$jscomp.propertyToPolyfillSymbol[r]&&(F=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[r]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(r):$jscomp.POLYFILL_PREFIX+F+"$"+r),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[r],{configurable:!0,writable:!0,value:z})))};
$jscomp.polyfill("Promise",function(f){function z(){this.batch_=null}function F(w){return w instanceof r?w:new r(function(B,x){B(w)})}if(f&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return f;z.prototype.asyncExecute=function(w){if(null==this.batch_){this.batch_=[];var B=this;this.asyncExecuteFunction(function(){B.executeBatch_()})}this.batch_.push(w)};
var q=$jscomp.global.setTimeout;z.prototype.asyncExecuteFunction=function(w){q(w,0)};z.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var w=this.batch_;this.batch_=[];for(var B=0;B<w.length;++B){var x=w[B];w[B]=null;try{x()}catch(G){this.asyncThrow_(G)}}}this.batch_=null};z.prototype.asyncThrow_=function(w){this.asyncExecuteFunction(function(){throw w;})};var r=function(w){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var B=this.createResolveAndReject_();
try{w(B.resolve,B.reject)}catch(x){B.reject(x)}};r.prototype.createResolveAndReject_=function(){function w(G){return function(M){x||(x=!0,G.call(B,M))}}var B=this,x=!1;return{resolve:w(this.resolveTo_),reject:w(this.reject_)}};r.prototype.resolveTo_=function(w){if(w===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(w instanceof r)this.settleSameAsPromise_(w);else{a:switch(typeof w){case "object":var B=null!=w;break a;case "function":B=!0;break a;default:B=!1}B?this.resolveToNonPromiseObj_(w):
this.fulfill_(w)}};r.prototype.resolveToNonPromiseObj_=function(w){var B=void 0;try{B=w.then}catch(x){this.reject_(x);return}"function"==typeof B?this.settleSameAsThenable_(B,w):this.fulfill_(w)};r.prototype.reject_=function(w){this.settle_(2,w)};r.prototype.fulfill_=function(w){this.settle_(1,w)};r.prototype.settle_=function(w,B){if(0!=this.state_)throw Error("Cannot settle("+w+", "+B+"): Promise already settled in state"+this.state_);this.state_=w;this.result_=B;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};r.prototype.scheduleUnhandledRejectionCheck_=function(){var w=this;q(function(){if(w.notifyUnhandledRejection_()){var B=$jscomp.global.console;"undefined"!==typeof B&&B.error(w.result_)}},1)};r.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var w=$jscomp.global.CustomEvent,B=$jscomp.global.Event,x=$jscomp.global.dispatchEvent;if("undefined"===typeof x)return!0;"function"===typeof w?w=new w("unhandledrejection",{cancelable:!0}):
"function"===typeof B?w=new B("unhandledrejection",{cancelable:!0}):(w=$jscomp.global.document.createEvent("CustomEvent"),w.initCustomEvent("unhandledrejection",!1,!0,w));w.promise=this;w.reason=this.result_;return x(w)};r.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var w=0;w<this.onSettledCallbacks_.length;++w)A.asyncExecute(this.onSettledCallbacks_[w]);this.onSettledCallbacks_=null}};var A=new z;r.prototype.settleSameAsPromise_=function(w){var B=this.createResolveAndReject_();
w.callWhenSettled_(B.resolve,B.reject)};r.prototype.settleSameAsThenable_=function(w,B){var x=this.createResolveAndReject_();try{w.call(B,x.resolve,x.reject)}catch(G){x.reject(G)}};r.prototype.then=function(w,B){function x(N,Q){return"function"==typeof N?function(S){try{G(N(S))}catch(V){M(V)}}:Q}var G,M,I=new r(function(N,Q){G=N;M=Q});this.callWhenSettled_(x(w,G),x(B,M));return I};r.prototype.catch=function(w){return this.then(void 0,w)};r.prototype.callWhenSettled_=function(w,B){function x(){switch(G.state_){case 1:w(G.result_);
break;case 2:B(G.result_);break;default:throw Error("Unexpected state: "+G.state_);}}var G=this;null==this.onSettledCallbacks_?A.asyncExecute(x):this.onSettledCallbacks_.push(x);this.isRejectionHandled_=!0};r.resolve=F;r.reject=function(w){return new r(function(B,x){x(w)})};r.race=function(w){return new r(function(B,x){for(var G=$jscomp.makeIterator(w),M=G.next();!M.done;M=G.next())F(M.value).callWhenSettled_(B,x)})};r.all=function(w){var B=$jscomp.makeIterator(w),x=B.next();return x.done?F([]):new r(function(G,
M){function I(S){return function(V){N[S]=V;Q--;0==Q&&G(N)}}var N=[],Q=0;do N.push(void 0),Q++,F(x.value).callWhenSettled_(I(N.length-1),M),x=B.next();while(!x.done)})};return r},"es6","es3");$jscomp.findInternal=function(f,z,F){f instanceof String&&(f=String(f));for(var q=f.length,r=0;r<q;r++){var A=f[r];if(z.call(F,A,r,f))return{i:r,v:A}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(z,F){return $jscomp.findInternal(this,z,F).v}},"es6","es3");
$jscomp.polyfill("Object.is",function(f){return f?f:function(z,F){return z===F?0!==z||1/z===1/F:z!==z&&F!==F}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(f){return f?f:function(z,F){var q=this;q instanceof String&&(q=String(q));var r=q.length;F=F||0;for(0>F&&(F=Math.max(F+r,0));F<r;F++){var A=q[F];if(A===z||Object.is(A,z))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(f,z,F){if(null==f)throw new TypeError("The 'this' value for String.prototype."+F+" must not be null or undefined");if(z instanceof RegExp)throw new TypeError("First argument to String.prototype."+F+" must not be a regular expression");return f+""};$jscomp.polyfill("String.prototype.includes",function(f){return f?f:function(z,F){return-1!==$jscomp.checkStringArgs(this,z,"includes").indexOf(z,F||0)}},"es6","es3");
(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function(f,z){if(!f.jstree){var F=0,q=!1,r=!1,A=!1,w=[],B=f("script:last").attr("src"),x=window.document,G=window.setImmediate,M=window.Promise;!G&&M&&(G=function(a,d){M.resolve(d).then(a)});f.jstree={version:"3.3.12",defaults:{plugins:[]},plugins:{},path:B&&-1!==B.indexOf("/")?B.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,
root:"#"};f.jstree.create=function(a,d){var b=new f.jstree.core(++F),c=d;d=f.extend(!0,{},f.jstree.defaults,d);c&&c.plugins&&(d.plugins=c.plugins);f.each(d.plugins,function(e,h){"core"!==e&&(b=b.plugin(h,d[h]))});f(a).data("jstree",b);b.init(a,d);return b};f.jstree.destroy=function(){f(".jstree:jstree").jstree("destroy");f(x).off(".jstree")};f.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,
worker_queue:[],focused:null}}};f.jstree.reference=function(a){var d=null,b=null;!a||!a.id||a.tagName&&a.nodeType||(a=a.id);if(!b||!b.length)try{b=f(a)}catch(c){}if(!b||!b.length)try{b=f("#"+a.replace(f.jstree.idregex,"\\$&"))}catch(c){}b&&b.length&&(b=b.closest(".jstree")).length&&(b=b.data("jstree"))?d=b:f(".jstree").each(function(){var c=f(this).data("jstree");if(c&&c._model.data[a])return d=c,!1});return d};f.fn.jstree=function(a){var d="string"===typeof a,b=Array.prototype.slice.call(arguments,
1),c=null;if(!0===a&&!this.length)return!1;this.each(function(){var e=f.jstree.reference(this),h=d&&e?e[a]:null;c=d&&h?h.apply(e,b):null;e||d||a!==z&&!f.isPlainObject(a)||f.jstree.create(this,a);if(e&&!d||!0===a)c=e||!1;if(null!==c&&c!==z)return!1});return null!==c&&c!==z?c:this};f.expr.pseudos.jstree=f.expr.createPseudo(function(a){return function(d){return f(d).hasClass("jstree")&&f(d).data("jstree")!==z}});f.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:f.noop,animation:200,
multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(a){a.type="click";f(a.currentTarget).trigger(a)},enter:function(a){a.type="click";f(a.currentTarget).trigger(a)},left:function(a){a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(a=this.get_parent(a.currentTarget))&&
a.id!==f.jstree.root&&this.get_node(a,!0).children(".jstree-anchor").trigger("focus")},up:function(a){a.preventDefault();(a=this.get_prev_dom(a.currentTarget))&&a.length&&a.children(".jstree-anchor").trigger("focus")},right:function(a){a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(d){this.get_node(d,!0).children(".jstree-anchor").trigger("focus")}):this.is_open(a.currentTarget)&&(a=this.get_node(a.currentTarget,!0).children(".jstree-children")[0])&&f(this._firstChild(a)).children(".jstree-anchor").trigger("focus")},
down:function(a){a.preventDefault();(a=this.get_next_dom(a.currentTarget))&&a.length&&a.children(".jstree-anchor").trigger("focus")},"*":function(a){this.open_all()},home:function(a){a.preventDefault();(a=this._firstChild(this.get_container_ul()[0]))&&f(a).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(a){a.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(a){a.preventDefault();this.edit(a.currentTarget)}}};f.jstree.core.prototype=
{plugin:function(a,d){var b=f.jstree.plugins[a];return b?(this._data[a]={},b.prototype=this,new b(d,this)):this},init:function(a,d){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this._model.data[f.jstree.root]={id:f.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this.element=f(a).addClass("jstree jstree-"+this._id);this.settings=d;this._data.core.ready=!1;this._data.core.loaded=!1;
this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===
this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+
"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24;this._data.core.node=this._create_prototype_node();this.trigger("loading");this.load_node(f.jstree.root)},destroy:function(a){this.trigger("destroy");if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(d){}a||this.element.empty();this.teardown()},_create_prototype_node:function(){var a=x.createElement("LI");a.setAttribute("role","none");var d=x.createElement("I");d.className=
"jstree-icon jstree-ocl";d.setAttribute("role","presentation");a.appendChild(d);d=x.createElement("A");d.className="jstree-anchor";d.setAttribute("href","#");d.setAttribute("tabindex","-1");d.setAttribute("role","treeitem");var b=x.createElement("I");b.className="jstree-icon jstree-themeicon";b.setAttribute("role","presentation");d.appendChild(b);a.appendChild(d);return a},_kbevent_to_func:function(a){var d=[];a.ctrlKey&&d.push("ctrl");a.altKey&&d.push("alt");a.shiftKey&&d.push("shift");d.push({8:"Backspace",
9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",
49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"}[a.which]||a.which);d=d.sort().join("-").toLowerCase();if("shift-shift"===d||"ctrl-ctrl"===d||"alt-alt"===
d)return null;a=this.settings.core.keyboard;var b;for(b in a)if(a.hasOwnProperty(b)){var c=b;"-"!==c&&"+"!==c&&(c=c.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS"),c=c.split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase());if(c===d)return a[b]}return null},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,
"")});this.element=null},bind:function(){var a="",d=null,b=0;this.element.on("dblclick.jstree",function(c){if(c.target.tagName&&"input"===c.target.tagName.toLowerCase())return!0;if(x.selection&&x.selection.empty)x.selection.empty();else if(window.getSelection){c=window.getSelection();try{c.removeAllRanges(),c.collapse()}catch(e){}}}).on("mousedown.jstree",function(c){c.target===this.element[0]&&(c.preventDefault(),b=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",function(c){c.preventDefault()}).on("click.jstree",
".jstree-ocl",function(c){this.toggle_node(c.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(c){if(c.target.tagName&&"input"===c.target.tagName.toLowerCase())return!0;this.settings.core.dblclick_toggle&&this.toggle_node(c.target)}.bind(this)).on("click.jstree",".jstree-anchor",function(c){c.preventDefault();c.currentTarget!==x.activeElement&&f(c.currentTarget).trigger("focus");this.activate_node(c.currentTarget,c)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(c){if(c.target.tagName&&
"input"===c.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===c.which?c.which=39:39===c.which&&(c.which=37));var e=this._kbevent_to_func(c);if(e&&(c=e.call(this,c),!1===c||!0===c))return c}.bind(this)).on("load_node.jstree",function(c,e){e.status&&(e.node.id!==f.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),
this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var h=[],g;var k=0;for(g=this._data.core.selected.length;k<g;k++)h=h.concat(this._model.data[this._data.core.selected[k]].parents);h=f.vakata.array_unique(h);k=0;for(g=h.length;k<g;k++)this.open_node(h[k],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),
0))}.bind(this)).on("keypress.jstree",function(c){if(c.target.tagName&&"input"===c.target.tagName.toLowerCase())return!0;d&&clearTimeout(d);d=setTimeout(function(){a=""},500);var e=String.fromCharCode(c.which).toLowerCase();c=this.element.find(".jstree-anchor").filter(":visible");var h=c.index(x.activeElement)||0,g=!1;a+=e;if(1<a.length){c.slice(h).each(function(k,l){if(0===f(l).text().toLowerCase().indexOf(a))return f(l).trigger("focus"),g=!0,!1}.bind(this));if(g)return;c.slice(0,h).each(function(k,
l){if(0===f(l).text().toLowerCase().indexOf(a))return f(l).trigger("focus"),g=!0,!1}.bind(this));if(g)return}(new RegExp("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$")).test(a)&&(c.slice(h+1).each(function(k,l){if(f(l).text().toLowerCase().charAt(0)===e)return f(l).trigger("focus"),g=!0,!1}.bind(this)),g||c.slice(0,h+1).each(function(k,l){if(f(l).text().toLowerCase().charAt(0)===e)return f(l).trigger("focus"),g=!0,!1}.bind(this)))}.bind(this)).on("init.jstree",function(){var c=this.settings.core.themes;
this._data.core.themes.dots=c.dots;this._data.core.themes.stripes=c.stripes;this._data.core.themes.icons=c.icons;this._data.core.themes.ellipsis=c.ellipsis;this.set_theme(c.name||"default",c.url);this.set_theme_variant(c.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]();this[this._data.core.themes.ellipsis?
"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(c){this._data.core.focused=null;f(c.currentTarget).filter(".jstree-hovered").trigger("mouseleave");this.element.attr("tabindex","0")}.bind(this)).on("focus.jstree",".jstree-anchor",function(c){var e=this.get_node(c.currentTarget);e&&e.id&&(this._data.core.focused=e.id);this.element.find(".jstree-hovered").not(c.currentTarget).trigger("mouseleave");f(c.currentTarget).trigger("mouseenter");this.element.attr("tabindex",
"-1")}.bind(this)).on("focus.jstree",function(){if(500<+new Date-b&&!this._data.core.focused&&this.settings.core.restore_focus){b=0;var c=this.get_node(this.element.attr("aria-activedescendant"),!0);c&&c.find("> .jstree-anchor").trigger("focus")}}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(c){this.hover_node(c.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(c){this.dehover_node(c.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree");
f(x).off(".jstree-"+this._id)},trigger:function(a,d){d||(d={});d.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",d)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var d=this.settings.core.strings;return f.vakata.is_function(d)?d.call(this,a):d&&d[a]?d[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=
a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,d){a&&a.id&&(a=a.id);a instanceof f&&a.length&&a[0].id&&(a=a[0].id);var b;try{if(this._model.data[a])a=this._model.data[a];else if("string"===typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"===typeof a&&(b=f("#"+a.replace(f.jstree.idregex,
"\\$&"),this.element)).length&&this._model.data[b.closest(".jstree-node").attr("id")])a=this._model.data[b.closest(".jstree-node").attr("id")];else if((b=this.element.find(a)).length&&this._model.data[b.closest(".jstree-node").attr("id")])a=this._model.data[b.closest(".jstree-node").attr("id")];else if((b=this.element.find(a)).length&&b.hasClass("jstree"))a=this._model.data[f.jstree.root];else return!1;d&&(a=a.id===f.jstree.root?this.element:f("#"+a.id.replace(f.jstree.idregex,"\\$&"),this.element));
return a}catch(c){return!1}},get_path:function(a,d,b){a=a.parents?a:this.get_node(a);if(!a||a.id===f.jstree.root||!a.parents)return!1;var c,e=[];e.push(b?a.id:a.text);var h=0;for(c=a.parents.length;h<c;h++)e.push(b?a.parents[h]:this.get_text(a.parents[h]));e=e.reverse().slice(1);return d?e.join(d):e},get_next_dom:function(a,d){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(d=this._firstChild(this.get_container_ul()[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);return d?f(d):!1}if(!a||!a.length)return!1;
if(d){d=a[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return d?f(d):!1}if(a.hasClass("jstree-open")){for(d=this._firstChild(a.children(".jstree-children")[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);if(null!==d)return f(d)}d=a[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return null!==d?f(d):a.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(a,d){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(d=this.get_container_ul()[0].lastChild;d&&
0===d.offsetHeight;)d=this._previousSibling(d);return d?f(d):!1}if(!a||!a.length)return!1;if(d){d=a[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);return d?f(d):!1}d=a[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);if(null!==d){for(a=f(d);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return(d=a[0].parentNode.parentNode)&&d.className&&-1!==d.className.indexOf("jstree-node")?f(d):!1},get_parent:function(a){return(a=
this.get_node(a))&&a.id!==f.jstree.root?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=
this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,d){var b,c;if(f.vakata.is_array(a))return this._load_nodes(a.slice(),d),!0;a=this.get_node(a);if(!a)return d&&d.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;var e=0;for(b=a.parents.length;e<b;e++)this._model.data[a.parents[e]].children_d=f.vakata.array_filter(this._model.data[a.parents[e]].children_d,
function(h){return-1===f.inArray(h,a.children_d)});e=0;for(b=a.children_d.length;e<b;e++)this._model.data[a.children_d[e]].state.selected&&(c=!0),delete this._model.data[a.children_d[e]];c&&(this._data.core.selected=f.vakata.array_filter(this._data.core.selected,function(h){return-1===f.inArray(h,a.children_d)}));a.children=[];a.children_d=[];c&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.failed=!1;a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",
!0);this._load_node(a,function(h){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=h;a.state.failed=!a.state.loaded;var g=this.get_node(a,!0),k,l=this._model.data,m=!1;var n=0;for(k=a.children.length;n<k;n++)if(l[a.children[n]]&&!l[a.children[n]].state.hidden){m=!0;break}a.state.loaded&&g&&g.length&&(g.removeClass("jstree-closed jstree-open jstree-leaf"),m?"#"!==a.id&&g.addClass(a.state.opened?"jstree-open":"jstree-closed"):g.addClass("jstree-leaf"));g.removeClass("jstree-loading").attr("aria-busy",
!1);this.trigger("load_node",{node:a,status:h});d&&d.call(this,a,h)}.bind(this));return!0},_load_nodes:function(a,d,b,c){var e=!0,h=function(){this._load_nodes(a,d,!0)},g=this._model.data,k,l=[];var m=0;for(k=a.length;m<k;m++)g[a[m]]&&(!g[a[m]].state.loaded&&!g[a[m]].state.failed||!b&&c)&&(this.is_loading(a[m])||this.load_node(a[m],h),e=!1);if(e){m=0;for(k=a.length;m<k;m++)g[a[m]]&&g[a[m]].state.loaded&&l.push(a[m]);d&&!d.done&&(d.call(this,l),d.done=!0)}},load_all:function(a,d){a||(a=f.jstree.root);
a=this.get_node(a);if(!a)return!1;var b=[],c=this._model.data,e=c[a.id].children_d,h;a.state&&!a.state.loaded&&b.push(a.id);var g=0;for(h=e.length;g<h;g++)c[e[g]]&&c[e[g]].state&&!c[e[g]].state.loaded&&b.push(e[g]);b.length?this._load_nodes(b,function(){this.load_all(a,d)}):(d&&d.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,d){var b=this.settings.core.data,c=function(){return 3!==this.nodeType&&8!==this.nodeType};if(!b)return a.id===f.jstree.root?this._append_html_data(a,
this._data.core.original_container_html.clone(!0),function(e){d.call(this,e)}):d.call(this,!1);if(f.vakata.is_function(b))return b.call(this,a,function(e){if(!1===e)d.call(this,!1);else this["string"===typeof e?"_append_html_data":"_append_json_data"](a,"string"===typeof e?f(f.parseHTML(e)).filter(c):e,function(h){d.call(this,h)})}.bind(this));if("object"===typeof b){if(b.url)return b=f.extend(!0,{},b),f.vakata.is_function(b.url)&&(b.url=b.url.call(this,a)),f.vakata.is_function(b.data)&&(b.data=b.data.call(this,
a)),f.ajax(b).done(function(e,h,g){if((h=g.getResponseHeader("Content-Type"))&&-1!==h.indexOf("json")||"object"===typeof e)return this._append_json_data(a,e,function(k){d.call(this,k)});if(h&&-1!==h.indexOf("html")||"string"===typeof e)return this._append_html_data(a,f(f.parseHTML(e)).filter(c),function(k){d.call(this,k)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:g})};this.settings.core.error.call(this,this._data.core.last_error);
return d.call(this,!1)}.bind(this)).fail(function(e){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:e})};d.call(this,!1);this.settings.core.error.call(this,this._data.core.last_error)}.bind(this));b=f.vakata.is_array(b)?f.extend(!0,[],b):f.isPlainObject(b)?f.extend(!0,{},b):b;if(a.id===f.jstree.root)return this._append_json_data(a,b,function(e){d.call(this,e)});this._data.core.last_error={error:"nodata",plugin:"core",
id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);return d.call(this,!1)}if("string"===typeof b){if(a.id===f.jstree.root)return this._append_html_data(a,f(f.parseHTML(b)).filter(c),function(e){d.call(this,e)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return d.call(this,
!1)},_node_changed:function(a){(a=this.get_node(a))&&-1===f.inArray(a.id,this._model.changed)&&this._model.changed.push(a.id)},_append_html_data:function(a,d,b){a=this.get_node(a);a.children=[];a.children_d=[];d=d.is("ul")?d.children():d;var c=a.id,e=[],h=[],g=this._model.data,k=g[c];a=this._data.core.selected.length;var l,m;d.each(function(n,t){if(l=this._parse_model_from_html(f(t),c,k.parents.concat()))e.push(l),h.push(l),g[l].children_d.length&&(h=h.concat(g[l].children_d))}.bind(this));k.children=
e;k.children_d=h;d=0;for(m=k.parents.length;d<m;d++)g[k.parents[d]].children_d=g[k.parents[d]].children_d.concat(h);this.trigger("model",{nodes:h,parent:c});c!==f.jstree.root?(this._node_changed(c),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});b.call(this,!0)},_append_json_data:function(a,d,b,c){if(null!==this.element){a=this.get_node(a);
a.children=[];a.children_d=[];d.d&&(d=d.d,"string"===typeof d&&(d=JSON.parse(d)));f.vakata.is_array(d)||(d=[d]);var e=null,h={df:this._model.default_state,dat:d,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},g=this,k=function(m,n){m.data&&(m=m.data);var t=m.dat,u=m.par,v=[],y=[],p=[],D=m.df,K=m.t_id,T=m.t_cnt,L=m.m,R=L[u];m=m.sel;var O,P=function(C,E,W){W=W?W.concat():[];E&&W.unshift(E);var U=C.id.toString();E={id:U,text:C.text||"",icon:C.icon!==n?C.icon:!0,
parent:E,parents:W,children:C.children||[],children_d:C.children_d||[],data:C.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(H in D)D.hasOwnProperty(H)&&(E.state[H]=D[H]);C&&C.data&&C.data.jstree&&C.data.jstree.icon&&(E.icon=C.data.jstree.icon);if(E.icon===n||null===E.icon||""===E.icon)E.icon=!0;if(C&&C.data&&(E.data=C.data,C.data.jstree))for(H in C.data.jstree)C.data.jstree.hasOwnProperty(H)&&(E.state[H]=C.data.jstree[H]);if(C&&"object"===typeof C.state)for(H in C.state)C.state.hasOwnProperty(H)&&
(E.state[H]=C.state[H]);if(C&&"object"===typeof C.li_attr)for(H in C.li_attr)C.li_attr.hasOwnProperty(H)&&(E.li_attr[H]=C.li_attr[H]);E.li_attr.id||(E.li_attr.id=U);if(C&&"object"===typeof C.a_attr)for(H in C.a_attr)C.a_attr.hasOwnProperty(H)&&(E.a_attr[H]=C.a_attr[H]);C&&C.children&&!0===C.children&&(E.state.loaded=!1,E.children=[],E.children_d=[]);L[E.id]=E;var H=0;for(U=E.children.length;H<U;H++){var Z=P(L[E.children[H]],E.id,W);var aa=L[Z];E.children_d.push(Z);aa.children_d.length&&(E.children_d=
E.children_d.concat(aa.children_d))}delete C.data;delete C.children;L[E.id].original=C;E.state.selected&&p.push(E.id);return E.id},X=function(C,E,W){W=W?W.concat():[];E&&W.unshift(E);do var U="j"+K+"_"+ ++T;while(L[U]);E={id:!1,text:"string"===typeof C?C:"",icon:"object"===typeof C&&C.icon!==n?C.icon:!0,parent:E,parents:W,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(H in D)D.hasOwnProperty(H)&&(E.state[H]=D[H]);C&&C.id&&(E.id=C.id.toString());C&&
C.text&&(E.text=C.text);C&&C.data&&C.data.jstree&&C.data.jstree.icon&&(E.icon=C.data.jstree.icon);if(E.icon===n||null===E.icon||""===E.icon)E.icon=!0;if(C&&C.data&&(E.data=C.data,C.data.jstree))for(H in C.data.jstree)C.data.jstree.hasOwnProperty(H)&&(E.state[H]=C.data.jstree[H]);if(C&&"object"===typeof C.state)for(H in C.state)C.state.hasOwnProperty(H)&&(E.state[H]=C.state[H]);if(C&&"object"===typeof C.li_attr)for(H in C.li_attr)C.li_attr.hasOwnProperty(H)&&(E.li_attr[H]=C.li_attr[H]);E.li_attr.id&&
!E.id&&(E.id=E.li_attr.id.toString());E.id||(E.id=U);E.li_attr.id||(E.li_attr.id=E.id);if(C&&"object"===typeof C.a_attr)for(H in C.a_attr)C.a_attr.hasOwnProperty(H)&&(E.a_attr[H]=C.a_attr[H]);if(C&&C.children&&C.children.length){var H=0;for(U=C.children.length;H<U;H++){var Z=X(C.children[H],E.id,W);var aa=L[Z];E.children.push(Z);aa.children_d.length&&(E.children_d=E.children_d.concat(aa.children_d))}E.children_d=E.children_d.concat(E.children)}C&&C.children&&!0===C.children&&(E.state.loaded=!1,E.children=
[],E.children_d=[]);delete C.data;delete C.children;E.original=C;L[E.id]=E;E.state.selected&&p.push(E.id);return E.id};if(t.length&&t[0].id!==n&&t[0].parent!==n){var J=0;for(O=t.length;J<O;J++)t[J].children||(t[J].children=[]),t[J].state||(t[J].state={}),L[t[J].id.toString()]=t[J];J=0;for(O=t.length;J<O;J++)L[t[J].parent.toString()]?(L[t[J].parent.toString()].children.push(t[J].id.toString()),R.children_d.push(t[J].id.toString())):"undefined"!==typeof g&&(g._data.core.last_error={error:"parse",plugin:"core",
id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:t[J].id.toString(),parent:t[J].parent.toString()})},g.settings.core.error.call(g,g._data.core.last_error));J=0;for(O=R.children.length;J<O;J++){var Y=P(L[R.children[J]],u,R.parents.concat());y.push(Y);L[Y].children_d.length&&(y=y.concat(L[Y].children_d))}}else{J=0;for(O=t.length;J<O;J++)if(Y=X(t[J],u,R.parents.concat()))v.push(Y),y.push(Y),L[Y].children_d.length&&(y=y.concat(L[Y].children_d));R.children=v;R.children_d=y}J=0;for(O=
R.parents.length;J<O;J++)L[R.parents[J]].children_d=L[R.parents[J]].children_d.concat(y);t={cnt:T,mod:L,sel:m,par:u,dpc:y,add:p};if("undefined"===typeof window||"undefined"===typeof window.document)postMessage(t);else return t},l=function(m,n){if(null!==this.element){this._cnt=m.cnt;var t=this._model.data;for(D in t)t.hasOwnProperty(D)&&t[D].state&&t[D].state.loading&&m.mod[D]&&(m.mod[D].state.loading=!0);this._model.data=m.mod;if(n){var u,v=m.add,y=m.sel,p=this._data.core.selected.slice();t=this._model.data;
if(y.length!==p.length||f.vakata.array_unique(y.concat(p)).length!==y.length){var D=0;for(u=y.length;D<u;D++)-1===f.inArray(y[D],v)&&-1===f.inArray(y[D],p)&&(t[y[D]].state.selected=!1);D=0;for(u=p.length;D<u;D++)-1===f.inArray(p[D],y)&&(t[p[D]].state.selected=!0)}}m.add.length&&(this._data.core.selected=this._data.core.selected.concat(m.add));this.trigger("model",{nodes:m.dpc,parent:m.par});m.par!==f.jstree.root?(this._node_changed(m.par),this.redraw()):this.redraw(!0);m.add.length&&this.trigger("changed",
{action:"model",selected:this._data.core.selected});!n&&G?G(function(){b.call(g,!0)}):b.call(g,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+k.toString()],{type:"text/javascript"}))),!this._data.core.working||c?(this._data.core.working=!0,e=new window.Worker(this._wrk),e.onmessage=function(m){l.call(this,m.data,!0);try{e.terminate(),e=null}catch(n){}this._data.core.worker_queue.length?
this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),h.par?e.postMessage(h):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([a,d,b,!0])}catch(m){l.call(this,k(h),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else l.call(this,k(h),
!1)}},_parse_model_from_html:function(a,d,b){b=b?[].concat(b):[];d&&b.unshift(d);var c,e,h=this._model.data,g={id:!1,text:!1,icon:!0,parent:d,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(k in this._model.default_state)this._model.default_state.hasOwnProperty(k)&&(g.state[k]=this._model.default_state[k]);d=f.vakata.attributes(a,!0);f.each(d,function(l,m){m=f.vakata.trim(m);if(!m.length)return!0;g.li_attr[l]=m;"id"===l&&(g.id=m.toString())});
d=a.children("a").first();d.length&&(d=f.vakata.attributes(d,!0),f.each(d,function(l,m){m=f.vakata.trim(m);m.length&&(g.a_attr[l]=m)}));d=a.children("a").first().length?a.children("a").first().clone():a.clone();d.children("ins, i, ul").remove();d=d.html();d=f("<div></div>").html(d);g.text=this.settings.core.force_text?d.text():d.html();d=a.data();g.data=d?f.extend(!0,{},d):null;g.state.opened=a.hasClass("jstree-open");g.state.selected=a.children("a").hasClass("jstree-clicked");g.state.disabled=a.children("a").hasClass("jstree-disabled");
if(g.data&&g.data.jstree)for(k in g.data.jstree)g.data.jstree.hasOwnProperty(k)&&(g.state[k]=g.data.jstree[k]);d=a.children("a").children(".jstree-themeicon");d.length&&(g.icon=d.hasClass("jstree-themeicon-hidden")?!1:d.attr("rel"));g.state.icon!==z&&(g.icon=g.state.icon);if(g.icon===z||null===g.icon||""===g.icon)g.icon=!0;d=a.children("ul").children("li");do var k="j"+this._id+"_"+ ++this._cnt;while(h[k]);g.id=g.li_attr.id?g.li_attr.id.toString():k;d.length?(d.each(function(l,m){c=this._parse_model_from_html(f(m),
g.id,b);e=this._model.data[c];g.children.push(c);e.children_d.length&&(g.children_d=g.children_d.concat(e.children_d))}.bind(this)),g.children_d=g.children_d.concat(g.children)):a.hasClass("jstree-closed")&&(g.state.loaded=!1);g.li_attr["class"]&&(g.li_attr["class"]=g.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));g.a_attr["class"]&&(g.a_attr["class"]=g.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));h[g.id]=g;g.state.selected&&this._data.core.selected.push(g.id);
return g.id},_parse_model_from_flat_json:function(a,d,b){b=b?b.concat():[];d&&b.unshift(d);var c=a.id.toString(),e=this._model.data,h=this._model.default_state;d={id:c,text:a.text||"",icon:a.icon!==z?a.icon:!0,parent:d,parents:b,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in h)h.hasOwnProperty(g)&&(d.state[g]=h[g]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(d.icon=a.data.jstree.icon);if(d.icon===z||null===d.icon||
""===d.icon)d.icon=!0;if(a&&a.data&&(d.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(d.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(d.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(d.li_attr[g]=a.li_attr[g]);d.li_attr.id||(d.li_attr.id=c);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(d.a_attr[g]=a.a_attr[g]);a&&
a.children&&!0===a.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]);e[d.id]=d;var g=0;for(c=d.children.length;g<c;g++){h=this._parse_model_from_flat_json(e[d.children[g]],d.id,b);var k=e[h];d.children_d.push(h);k.children_d.length&&(d.children_d=d.children_d.concat(k.children_d))}delete a.data;delete a.children;e[d.id].original=a;d.state.selected&&this._data.core.selected.push(d.id);return d.id},_parse_model_from_json:function(a,d,b){b=b?b.concat():[];d&&b.unshift(d);var c=this._model.data;
var e=this._model.default_state;do var h="j"+this._id+"_"+ ++this._cnt;while(c[h]);d={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==z?a.icon:!0,parent:d,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in e)e.hasOwnProperty(g)&&(d.state[g]=e[g]);a&&a.id&&(d.id=a.id.toString());a&&a.text&&(d.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(d.icon=a.data.jstree.icon);if(d.icon===z||null===d.icon||""===d.icon)d.icon=
!0;if(a&&a.data&&(d.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(d.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(d.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(d.li_attr[g]=a.li_attr[g]);d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString());d.id||(d.id=h);d.li_attr.id||(d.li_attr.id=d.id);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&
(d.a_attr[g]=a.a_attr[g]);if(a&&a.children&&a.children.length){var g=0;for(h=a.children.length;g<h;g++){e=this._parse_model_from_json(a.children[g],d.id,b);var k=c[e];d.children.push(e);k.children_d.length&&(d.children_d=d.children_d.concat(k.children_d))}d.children_d=d.children.concat(d.children_d)}a&&a.children&&!0===a.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]);delete a.data;delete a.children;d.original=a;c[d.id]=d;d.state.selected&&this._data.core.selected.push(d.id);return d.id},
_redraw:function(){var a=this._model.force_full_redraw?this._model.data[f.jstree.root].children.concat([]):this._model.changed.concat([]),d=x.createElement("UL"),b,c,e=this._data.core.focused;var h=0;for(c=a.length;h<c;h++)(b=this.redraw_node(a[h],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&d.appendChild(b);this._model.force_full_redraw&&(d.className=this.get_container_ul()[0].className,d.setAttribute("role","group"),this.element.empty().append(d));null!==e&&this.settings.core.restore_focus&&
((b=this.get_node(e,!0))&&b.length&&b.children(".jstree-anchor")[0]!==x.activeElement?b.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},draw_children:function(a){var d=this.get_node(a),b;if(!d)return!1;if(d.id===f.jstree.root)return this.redraw(!0);a=this.get_node(a,!0);if(!a||!a.length)return!1;a.children(".jstree-children").remove();
a=a[0];if(d.children.length&&d.state.loaded){var c=x.createElement("UL");c.setAttribute("role","group");c.className="jstree-children";var e=0;for(b=d.children.length;e<b;e++)c.appendChild(this.redraw_node(d.children[e],!0,!0));a.appendChild(c)}},redraw_node:function(a,d,b,c){var e=this.get_node(a),h=!1,g=!1,k=!1,l=!1,m=!1,n=!1,t="";n=this._model.data;var u=!1,v=null;t=m=0;var y=!1,p=!1;if(!e)return!1;if(e.id===f.jstree.root)return this.redraw(!0);d=d||0===e.children.length;if(a=x.querySelector?this.element[0].querySelector("#"+
(-1!=="0123456789".indexOf(e.id[0])?"\\3"+e.id[0]+" "+e.id.substr(1).replace(f.jstree.idregex,"\\$&"):e.id.replace(f.jstree.idregex,"\\$&"))):x.getElementById(e.id))a=f(a),b||(h=a.parent().parent()[0],h===this.element[0]&&(h=null),g=a.index()),d||!e.children.length||a.children(".jstree-children").length||(d=!0),d||(k=a.children(".jstree-children")[0]),u=a.children(".jstree-anchor")[0]===x.activeElement,a.remove();else if(d=!0,!b){h=e.parent!==f.jstree.root?f("#"+e.parent.replace(f.jstree.idregex,
"\\$&"),this.element)[0]:null;if(!(null===h||h&&n[e.parent].state.opened))return!1;g=f.inArray(e.id,null===h?n[f.jstree.root].children:n[e.parent].children)}a=this._data.core.node.cloneNode(!0);t="jstree-node ";for(l in e.li_attr)e.li_attr.hasOwnProperty(l)&&"id"!==l&&("class"!==l?a.setAttribute(l,e.li_attr[l]):t+=e.li_attr[l]);e.a_attr.id||(e.a_attr.id=e.id+"_anchor");a.childNodes[1].setAttribute("aria-selected",!!e.state.selected);a.childNodes[1].setAttribute("aria-level",e.parents.length);this.settings.core.compute_elements_positions&&
(a.childNodes[1].setAttribute("aria-setsize",n[e.parent].children.length),a.childNodes[1].setAttribute("aria-posinset",n[e.parent].children.indexOf(e.id)+1));e.state.disabled&&a.childNodes[1].setAttribute("aria-disabled",!0);l=0;for(m=e.children.length;l<m;l++)if(!n[e.children[l]].state.hidden){y=!0;break}if(null!==e.parent&&n[e.parent]&&!e.state.hidden&&(l=f.inArray(e.id,n[e.parent].children),p=e.id,-1!==l))for(l++,m=n[e.parent].children.length;l<m&&(n[n[e.parent].children[l]].state.hidden||(p=n[e.parent].children[l]),
p===e.id);l++);e.state.hidden&&(t+=" jstree-hidden");e.state.loading&&(t+=" jstree-loading");e.state.loaded&&!y?t+=" jstree-leaf":(t+=e.state.opened&&e.state.loaded?" jstree-open":" jstree-closed",a.childNodes[1].setAttribute("aria-expanded",e.state.opened&&e.state.loaded));p===e.id&&(t+=" jstree-last");a.id=e.id;a.className=t;t=(e.state.selected?" jstree-clicked":"")+(e.state.disabled?" jstree-disabled":"");for(m in e.a_attr)!e.a_attr.hasOwnProperty(m)||"href"===m&&"#"===e.a_attr[m]||("class"!==
m?a.childNodes[1].setAttribute(m,e.a_attr[m]):t+=" "+e.a_attr[m]);t.length&&(a.childNodes[1].className="jstree-anchor "+t);if(e.icon&&!0!==e.icon||!1===e.icon)!1===e.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===e.icon.indexOf("/")&&-1===e.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+e.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage='url("'+e.icon+'")',a.childNodes[1].childNodes[0].style.backgroundPosition="center center",
a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");this.settings.core.force_text?a.childNodes[1].appendChild(x.createTextNode(e.text)):a.childNodes[1].innerHTML+=e.text;if(d&&e.children.length&&(e.state.opened||c)&&e.state.loaded){n=x.createElement("UL");n.setAttribute("role","group");n.className="jstree-children";l=0;for(m=e.children.length;l<m;l++)n.appendChild(this.redraw_node(e.children[l],d,!0));a.appendChild(n)}k&&a.appendChild(k);
if(!b){h||(h=this.element[0]);l=0;for(m=h.childNodes.length;l<m;l++)if(h.childNodes[l]&&h.childNodes[l].className&&-1!==h.childNodes[l].className.indexOf("jstree-children")){v=h.childNodes[l];break}v||(v=x.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",h.appendChild(v));h=v;g<h.childNodes.length?h.insertBefore(a,h.childNodes[g]):h.appendChild(a);u&&(m=this.element[0].scrollTop,t=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=
t)}e.state.opened&&!e.state.loaded&&(e.state.opened=!1,setTimeout(function(){this.open_node(e.id,!1,0)}.bind(this),0));return a},open_node:function(a,d,b){var c;if(f.vakata.is_array(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.open_node(a[e],d,b);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;b=b===z?this.settings.core.animation:b;if(!this.is_closed(a))return d&&d.call(this,a,!1),!1;if(this.is_loaded(a)){e=this.get_node(a,!0);var h=this;e.length&&(b&&e.children(".jstree-children").length&&
e.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(e.children(".jstree-children")[0])&&this.draw_children(a),b?(this.trigger("before_open",{node:a}),e.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(b,function(){this.style.display="";h.element&&h.trigger("after_open",{node:a})})):(this.trigger("before_open",
{node:a}),e[0].className=e[0].className.replace("jstree-closed","jstree-open"),e[0].childNodes[1].setAttribute("aria-expanded",!0)));a.state.opened=!0;d&&d.call(this,a,!0);e.length||this.trigger("before_open",{node:a});this.trigger("open_node",{node:a});b&&e.length||this.trigger("after_open",{node:a});return!0}if(this.is_loading(a))return setTimeout(function(){this.open_node(a,d,b)}.bind(this),500);this.load_node(a,function(g,k){return k?this.open_node(g,d,b):d?d.call(this,g,!1):!1})},_open_to:function(a){a=
this.get_node(a);if(!a||a.id===f.jstree.root)return!1;var d,b=a.parents;var c=0;for(d=b.length;c<d;c+=1)c!==f.jstree.root&&this.open_node(b[c],!1,0);return f("#"+a.id.replace(f.jstree.idregex,"\\$&"),this.element)},close_node:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.close_node(a[c],d);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root||this.is_closed(a))return!1;d=d===z?this.settings.core.animation:d;var e=this;var h=this.get_node(a,!0);a.state.opened=
!1;this.trigger("close_node",{node:a});h.length?d?h.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(d,function(){this.style.display="";h.children(".jstree-children").remove();e.element&&e.trigger("after_close",{node:a})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.children(".jstree-anchor").attr("aria-expanded",
!1),h.children(".jstree-children").remove(),this.trigger("after_close",{node:a})):this.trigger("after_close",{node:a})},toggle_node:function(a){var d;if(f.vakata.is_array(a)){a=a.slice();var b=0;for(d=a.length;b<d;b++)this.toggle_node(a[b]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,d,b){a||(a=f.jstree.root);a=this.get_node(a);if(!a)return!1;var c=a.id===f.jstree.root?this.get_container_ul():this.get_node(a,!0),e;if(!c.length){c=
0;for(e=a.children_d.length;c<e;c++)this.is_closed(this._model.data[a.children_d[c]])&&(this._model.data[a.children_d[c]].state.opened=!0);return this.trigger("open_all",{node:a})}b=b||c;var h=this;c=this.is_closed(a)?c.find(".jstree-closed").addBack():c.find(".jstree-closed");c.each(function(){h.open_node(this,function(g,k){k&&this.is_parent(g)&&this.open_all(g,d,b)},d||0)});0===b.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(b)})},close_all:function(a,d){a||(a=f.jstree.root);
a=this.get_node(a);if(!a)return!1;var b=a.id===f.jstree.root?this.get_container_ul():this.get_node(a,!0),c=this,e;b.length&&(b=this.is_open(a)?b.find(".jstree-open").addBack():b.find(".jstree-open"),f(b.get().reverse()).each(function(){c.close_node(this,d||0)}));b=0;for(e=a.children_d.length;b<e;b++)this._model.data[a.children_d[b]].state.opened=!1;this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var d;if(f.vakata.is_array(a)){a=
a.slice();var b=0;for(d=a.length;b<d;b++)this.enable_node(a[b]);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:a})},disable_node:function(a){var d;if(f.vakata.is_array(a)){a=a.slice();var b=0;for(d=a.length;b<d;b++)this.disable_node(a[b]);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;a.state.disabled=!0;this.get_node(a,
!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:a})},is_hidden:function(a){a=this.get_node(a);return!0===a.state.hidden},hide_node:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.hide_node(a[c],!0);d||this.redraw();return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;a.state.hidden||(a.state.hidden=!0,this._node_changed(a.parent),d||this.redraw(),this.trigger("hide_node",
{node:a}))},show_node:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.show_node(a[c],!0);d||this.redraw();return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;a.state.hidden&&(a.state.hidden=!1,this._node_changed(a.parent),d||this.redraw(),this.trigger("show_node",{node:a}))},hide_all:function(a){var d,b=this._model.data,c=[];for(d in b)b.hasOwnProperty(d)&&d!==f.jstree.root&&!b[d].state.hidden&&(b[d].state.hidden=!0,c.push(d));this._model.force_full_redraw=
!0;a||this.redraw();this.trigger("hide_all",{nodes:c});return c},show_all:function(a){var d,b=this._model.data,c=[];for(d in b)b.hasOwnProperty(d)&&d!==f.jstree.root&&b[d].state.hidden&&(b[d].state.hidden=!1,c.push(d));this._model.force_full_redraw=!0;a||this.redraw();this.trigger("show_all",{nodes:c});return c},activate_node:function(a,d){if(this.is_disabled(a))return!1;d&&"object"===typeof d||(d={});this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==z?this.get_node(this._data.core.last_clicked.id):
null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(d.metaKey||d.ctrlKey||d.shiftKey)&&(!d.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(d.shiftKey){var b=this.get_node(a).id,
c=this._data.core.last_clicked.id,e=this.get_node(this._data.core.last_clicked.parent).children,h=!1,g;var k=0;for(g=e.length;k<g;k+=1)e[k]===b&&(h=!h),e[k]===c&&(h=!h),this.is_disabled(e[k])||!h&&e[k]!==b&&e[k]!==c?this.deselect_node(e[k],!0,d):this.is_hidden(e[k])||this.select_node(e[k],!0,!1,d);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:d})}else this.is_selected(a)?this.deselect_node(a,!1,d):this.select_node(a,!1,!1,d);else!this.settings.core.multiple&&
(d.metaKey||d.ctrlKey||d.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,d):(this.deselect_all(!0),this.select_node(a,!1,!1,d),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a),event:d})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var d=this.element.find(".jstree-hovered"),b=this.element;d&&d.length&&this.dehover_node(d);a.children(".jstree-anchor").addClass("jstree-hovered");
this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){b.attr("aria-activedescendant",a[0].id)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,d,b,c){var e;if(f.vakata.is_array(a)){a=a.slice();var h=0;for(e=a.length;h<e;h++)this.select_node(a[h],d,b,c);return!0}a=this.get_node(a);
if(!a||a.id===f.jstree.root)return!1;h=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),b||(h=this._open_to(a)),h&&h.length&&h.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:c}),d||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:c}))},deselect_node:function(a,d,b){var c;if(f.vakata.is_array(a)){a=a.slice();
var e=0;for(c=a.length;e<c;e++)this.deselect_node(a[e],d,b);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;e=this.get_node(a,!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=f.vakata.array_remove_item(this._data.core.selected,a.id),e.length&&e.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:b}),d||this.trigger("changed",{action:"deselect_node",node:a,
selected:this._data.core.selected,event:b}))},select_all:function(a){var d=this._data.core.selected.concat([]),b;this._data.core.selected=this._model.data[f.jstree.root].children_d.concat();var c=0;for(b=this._data.core.selected.length;c<b;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,
old_selection:d})},deselect_all:function(a){var d=this._data.core.selected.concat([]),b;var c=0;for(b=this._data.core.selected.length;c<b;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:d});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,
old_selection:d})},is_selected:function(a){return(a=this.get_node(a))&&a.id!==f.jstree.root?a.state.selected:!1},get_selected:function(a){return a?f.map(this._data.core.selected,function(d){return this.get_node(d)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(a){var d=this.get_selected(!0),b={},c,e;var h=0;for(c=d.length;h<c;h++)b[d[h].id]=d[h];h=0;for(c=d.length;h<c;h++){var g=0;for(e=d[h].children_d.length;g<e;g++)b[d[h].children_d[g]]&&delete b[d[h].children_d[g]]}d=
[];for(h in b)b.hasOwnProperty(h)&&d.push(h);return a?f.map(d,function(k){return this.get_node(k)}.bind(this)):d},get_bottom_selected:function(a){var d=this.get_selected(!0),b=[],c;var e=0;for(c=d.length;e<c;e++)d[e].children.length||b.push(d[e].id);return a?f.map(b,function(h){return this.get_node(h)}.bind(this)):b},get_state:function(){var a={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},d;for(d in this._model.data)this._model.data.hasOwnProperty(d)&&
d!==f.jstree.root&&(this._model.data[d].state.loaded&&this.settings.core.loaded_state&&a.core.loaded.push(d),this._model.data[d].state.opened&&a.core.open.push(d),this._model.data[d].state.selected&&a.core.selected.push(d));return a},set_state:function(a,d){if(a){a.core&&a.core.selected&&a.core.initial_selection===z&&(a.core.initial_selection=this._data.core.selected.concat([]).sort().join(","));if(a.core){var b;if(a.core.loaded)return this.settings.core.loaded_state&&f.vakata.is_array(a.core.loaded)&&
a.core.loaded.length?this._load_nodes(a.core.loaded,function(e){delete a.core.loaded;this.set_state(a,d)}):(delete a.core.loaded,this.set_state(a,d)),!1;if(a.core.open)return f.vakata.is_array(a.core.open)&&a.core.open.length?this._load_nodes(a.core.open,function(e){this.open_node(e,!1,0);delete a.core.open;this.set_state(a,d)}):(delete a.core.open,this.set_state(a,d)),!1;if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==z&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==
z&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,d),!1;if(a.core.selected){var c=this;if(a.core.initial_selection===z||a.core.initial_selection===this._data.core.selected.concat([]).sort().join(","))this.deselect_all(),f.each(a.core.selected,function(e,h){c.select_node(h,!1,!0)});delete a.core.initial_selection;delete a.core.selected;this.set_state(a,d);return!1}for(b in a)a.hasOwnProperty(b)&&"core"!==b&&-1===f.inArray(b,this.settings.plugins)&&delete a[b];if(f.isEmptyObject(a.core))return delete a.core,
this.set_state(a,d),!1}return f.isEmptyObject(a)?(a=null,d&&d.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,d){this._data.core.state=!0===d?{}:this.get_state();d&&f.vakata.is_function(d)&&(this._data.core.state=d.call(this,this._data.core.state));this._cnt=0;this._model.data={};this._model.data[f.jstree.root]={id:f.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this._data.core.selected=[];this._data.core.last_clicked=null;this._data.core.focused=
null;var b=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+b+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node(f.jstree.root,function(c,
e){e&&(this.get_container_ul()[0].className=b,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(f.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;var d=[],b=[],c=this._data.core.selected.concat([]);b.push(a.id);!0===a.state.opened&&d.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){b.push(this.id);
d.push(this.id)});this._load_nodes(b,function(e){this.open_node(d,!1,0);this.select_node(c);this.trigger("refresh_node",{node:a,nodes:e})}.bind(this),!1,!0)},set_id:function(a,d){a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;var b,c=this._model.data,e=a.id;d=d.toString();c[a.parent].children[f.inArray(a.id,c[a.parent].children)]=d;var h=0;for(b=a.parents.length;h<b;h++)c[a.parents[h]].children_d[f.inArray(a.id,c[a.parents[h]].children_d)]=d;h=0;for(b=a.children.length;h<b;h++)c[a.children[h]].parent=
d;h=0;for(b=a.children_d.length;h<b;h++)c[a.children_d[h]].parents[f.inArray(a.id,c[a.children_d[h]].parents)]=d;h=f.inArray(a.id,this._data.core.selected);-1!==h&&(this._data.core.selected[h]=d);if(h=this.get_node(a.id,!0))h.attr("id",d),this.element.attr("aria-activedescendant")===a.id&&this.element.attr("aria-activedescendant",d);delete c[a.id];a.id=d;a.li_attr.id=d;c[d]=a;this.trigger("set_id",{node:a,"new":a.id,old:e});return!0},get_text:function(a){return(a=this.get_node(a))&&a.id!==f.jstree.root?
a.text:!1},set_text:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.set_text(a[c],d);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;a.text=d;this.get_node(a,!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:d});return!0},get_json:function(a,d,b){a=this.get_node(a||f.jstree.root);if(!a)return!1;d&&d.flat&&!b&&(b=[]);var c={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:f.extend(!0,{},a.li_attr),a_attr:f.extend(!0,
{},a.a_attr),state:{},data:d&&d.no_data?!1:f.extend(!0,f.vakata.is_array(a.data)?[]:{},a.data)},e;d&&d.flat?c.parent=a.parent:c.children=[];if(d&&d.no_state)delete c.state;else for(h in a.state)a.state.hasOwnProperty(h)&&(c.state[h]=a.state[h]);d&&d.no_li_attr&&delete c.li_attr;d&&d.no_a_attr&&delete c.a_attr;d&&d.no_id&&(delete c.id,c.li_attr&&c.li_attr.id&&delete c.li_attr.id,c.a_attr&&c.a_attr.id&&delete c.a_attr.id);d&&d.flat&&a.id!==f.jstree.root&&b.push(c);if(!d||!d.no_children){var h=0;for(e=
a.children.length;h<e;h++)d&&d.flat?this.get_json(a.children[h],d,b):c.children.push(this.get_json(a.children[h],d))}return d&&d.flat?b:a.id===f.jstree.root?c.children:c},create_node:function(a,d,b,c,e){null===a&&(a=f.jstree.root);a=this.get_node(a);if(!a)return!1;b=b===z?"last":b;if(!b.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,d,b,c,!0)});d||(d={text:this.get_string("New node")});d="string"===typeof d?{text:d}:f.extend(!0,{},
d);d.text===z&&(d.text=this.get_string("New node"));var h;a.id===f.jstree.root&&("before"===b&&(b="first"),"after"===b&&(b="last"));switch(b){case "before":e=this.get_node(a.parent);b=f.inArray(a.id,e.children);a=e;break;case "after":e=this.get_node(a.parent);b=f.inArray(a.id,e.children)+1;a=e;break;case "inside":case "first":b=0;break;case "last":b=a.children.length;break;default:b||(b=0)}b>a.children.length&&(b=a.children.length);d.id||(d.id=!0);if(!this.check("create_node",d,a,b))return this.settings.core.error.call(this,
this._data.core.last_error),!1;!0===d.id&&delete d.id;d=this._parse_model_from_json(d,a.id,a.parents.concat());if(!d)return!1;e=this.get_node(d);var g=[];g.push(d);g=g.concat(e.children_d);this.trigger("model",{nodes:g,parent:a.id});a.children_d=a.children_d.concat(g);var k=0;for(h=a.parents.length;k<h;k++)this._model.data[a.parents[k]].children_d=this._model.data[a.parents[k]].children_d.concat(g);d=e;e=[];k=0;for(h=a.children.length;k<h;k++)e[k>=b?k+1:k]=a.children[k];e[b]=d.id;a.children=e;this.redraw_node(a,
!0);this.trigger("create_node",{node:this.get_node(d),parent:a.id,position:b});c&&c.call(this,this.get_node(d));return d.id},rename_node:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.rename_node(a[c],d);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;c=a.text;if(!this.check("rename_node",a,this.get_parent(a),d))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,d);this.trigger("rename_node",{node:a,
text:d,old:c});return!0},delete_node:function(a){var d,b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(d=a.length;c<d;c++)this.delete_node(a[c]);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;c=this.get_node(a.parent);var e=f.inArray(a.id,c.children);d=!1;if(!this.check("delete_node",a,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==e&&(c.children=f.vakata.array_remove(c.children,e));var h=a.children_d.concat([]);h.push(a.id);e=0;for(b=a.parents.length;e<
b;e++)this._model.data[a.parents[e]].children_d=f.vakata.array_filter(this._model.data[a.parents[e]].children_d,function(g){return-1===f.inArray(g,h)});e=0;for(b=h.length;e<b;e++)if(this._model.data[h[e]].state.selected){d=!0;break}d&&(this._data.core.selected=f.vakata.array_filter(this._data.core.selected,function(g){return-1===f.inArray(g,h)}));this.trigger("delete_node",{node:a,parent:c.id});d&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:c.id});
e=0;for(b=h.length;e<b;e++)delete this._model.data[h[e]];-1!==f.inArray(this._data.core.focused,h)&&(this._data.core.focused=null,a=this.element[0].scrollTop,d=this.element[0].scrollLeft,c.id===f.jstree.root?this._model.data[f.jstree.root].children[0]&&this.get_node(this._model.data[f.jstree.root].children[0],!0).children(".jstree-anchor").trigger("focus"):this.get_node(c,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=a,this.element[0].scrollLeft=d);this.redraw_node(c,!0);
return!0},check:function(a,d,b,c,e){d=d&&d.id?d:this.get_node(d);b=b&&b.id?b:this.get_node(b);var h=a.match(/^move_node|copy_node|create_node$/i)?b:d,g=this.settings.core.check_callback;if("move_node"===a||"copy_node"===a){if(!(e&&e.is_multi||"move_node"!==a||f.inArray(d.id,b.children)!==c))return this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:a,pos:c,obj:d&&d.id?d.id:!1,par:b&&b.id?b.id:!1})},!1;if(!(e&&e.is_multi||
d.id!==b.id&&("move_node"!==a||f.inArray(d.id,b.children)!==c)&&-1===f.inArray(b.id,d.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:c,obj:d&&d.id?d.id:!1,par:b&&b.id?b.id:!1})},!1}h&&h.data&&(h=h.data);return h&&h.functions&&(!1===h.functions[a]||!0===h.functions[a])?(!1===h.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+
a,data:JSON.stringify({chk:a,pos:c,obj:d&&d.id?d.id:!1,par:b&&b.id?b.id:!1})}),h.functions[a]):!1===g||f.vakata.is_function(g)&&!1===g.call(this,a,d,b,c,e)||g&&!1===g[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:c,obj:d&&d.id?d.id:!1,par:b&&b.id?b.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,d,b,c,e,h,g){var k,l,m,n;d=this.get_node(d);
b=b===z?0:b;if(!d)return!1;if(!b.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(a,d,b,c,!0,!1,g)});if(f.vakata.is_array(a))if(1===a.length)a=a[0];else{h=0;for(k=a.length;h<k;h++)if(l=this.move_node(a[h],d,b,c,e,!1,g))d=l,b="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||a.id===f.jstree.root)return!1;k=(a.parent||f.jstree.root).toString();var t=b.toString().match(/^(before|after)$/)&&d.id!==f.jstree.root?this.get_node(d.parent):
d;var u=g?g:this._model.data[a.id]?this:f.jstree.reference(a.id);l=!u||!u._id||this._id!==u._id;var v=u&&u._id&&k&&u._model.data[k]&&u._model.data[k].children?f.inArray(a.id,u._model.data[k].children):-1;u&&u._id&&(a=u._model.data[a.id]);if(l)return(l=this.copy_node(a,d,b,c,e,!1,g))?(u&&u.delete_node(a),l):!1;d.id===f.jstree.root&&("before"===b&&(b="first"),"after"===b&&(b="last"));switch(b){case "before":b=f.inArray(d.id,t.children);break;case "after":b=f.inArray(d.id,t.children)+1;break;case "inside":case "first":b=
0;break;case "last":b=t.children.length;break;default:b||(b=0)}b>t.children.length&&(b=t.children.length);if(!this.check("move_node",a,t,b,{core:!0,origin:g,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===t.id){e=t.children.concat();l=f.inArray(a.id,e);-1!==l&&(e=f.vakata.array_remove(e,l),b>l&&b--);l=[];var y=0;for(m=e.length;y<m;y++)l[y>=b?y+1:y]=e[y];l[b]=a.id;t.children=l;this._node_changed(t.id);
this.redraw(t.id===f.jstree.root)}else{l=a.children_d.concat();l.push(a.id);y=0;for(m=a.parents.length;y<m;y++){e=[];var p=u._model.data[a.parents[y]].children_d;var D=0;for(n=p.length;D<n;D++)-1===f.inArray(p[D],l)&&e.push(p[D]);u._model.data[a.parents[y]].children_d=e}u._model.data[k].children=f.vakata.array_remove_item(u._model.data[k].children,a.id);y=0;for(m=t.parents.length;y<m;y++)this._model.data[t.parents[y]].children_d=this._model.data[t.parents[y]].children_d.concat(l);e=[];y=0;for(m=t.children.length;y<
m;y++)e[y>=b?y+1:y]=t.children[y];e[b]=a.id;t.children=e;t.children_d.push(a.id);t.children_d=t.children_d.concat(a.children_d);a.parent=t.id;l=t.parents.concat();l.unshift(t.id);p=a.parents.length;a.parents=l;l=l.concat();y=0;for(m=a.children_d.length;y<m;y++)this._model.data[a.children_d[y]].parents=this._model.data[a.children_d[y]].parents.slice(0,-1*p),Array.prototype.push.apply(this._model.data[a.children_d[y]].parents,l);if(k===f.jstree.root||t.id===f.jstree.root)this._model.force_full_redraw=
!0;this._model.force_full_redraw||(this._node_changed(k),this._node_changed(t.id));h||this.redraw()}c&&c.call(this,a,t,b);this.trigger("move_node",{node:a,parent:t.id,position:b,old_parent:k,old_position:v,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this});return a.id},copy_node:function(a,d,b,c,e,h,g){var k,l,m,n;d=this.get_node(d);b=b===z?0:b;if(!d)return!1;if(!b.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(a,
d,b,c,!0,!1,g)});if(f.vakata.is_array(a))if(1===a.length)a=a[0];else{h=0;for(k=a.length;h<k;h++)if(l=this.copy_node(a[h],d,b,c,e,!0,g))d=l,b="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||a.id===f.jstree.root)return!1;k=(a.parent||f.jstree.root).toString();var t=b.toString().match(/^(before|after)$/)&&d.id!==f.jstree.root?this.get_node(d.parent):d;(n=g?g:this._model.data[a.id]?this:f.jstree.reference(a.id))&&n._id&&(a=n._model.data[a.id]);d.id===f.jstree.root&&("before"===b&&(b=
"first"),"after"===b&&(b="last"));switch(b){case "before":b=f.inArray(d.id,t.children);break;case "after":b=f.inArray(d.id,t.children)+1;break;case "inside":case "first":b=0;break;case "last":b=t.children.length;break;default:b||(b=0)}b>t.children.length&&(b=t.children.length);if(!this.check("copy_node",a,t,b,{core:!0,origin:g,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;var u=n?n.get_json(a,{no_id:!0,no_data:!0,
no_state:!0}):a;if(!u)return!1;!0===u.id&&delete u.id;u=this._parse_model_from_json(u,t.id,t.parents.concat());if(!u)return!1;l=this.get_node(u);a&&a.state&&!1===a.state.loaded&&(l.state.loaded=!1);e=[];e.push(u);e=e.concat(l.children_d);this.trigger("model",{nodes:e,parent:t.id});u=0;for(m=t.parents.length;u<m;u++)this._model.data[t.parents[u]].children_d=this._model.data[t.parents[u]].children_d.concat(e);e=[];u=0;for(m=t.children.length;u<m;u++)e[u>=b?u+1:u]=t.children[u];e[b]=l.id;t.children=
e;t.children_d.push(l.id);t.children_d=t.children_d.concat(l.children_d);t.id===f.jstree.root&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||this._node_changed(t.id);h||this.redraw(t.id===f.jstree.root);c&&c.call(this,l,t,b);this.trigger("copy_node",{node:l,original:a,parent:t.id,position:b,old_parent:k,old_position:n&&n._id&&k&&n._model.data[k]&&n._model.data[k].children?f.inArray(a.id,n._model.data[k].children):-1,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id,old_instance:n,
new_instance:this});return l.id},cut:function(a){a||(a=this._data.core.selected.concat());f.vakata.is_array(a)||(a=[a]);if(!a.length)return!1;var d=[],b,c;var e=0;for(c=a.length;e<c;e++)(b=this.get_node(a[e]))&&b.id&&b.id!==f.jstree.root&&d.push(b);if(!d.length)return!1;q=d;A=this;r="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());f.vakata.is_array(a)||(a=[a]);if(!a.length)return!1;var d=[],b,c;var e=0;for(c=a.length;e<c;e++)(b=this.get_node(a[e]))&&
b.id&&b.id!==f.jstree.root&&d.push(b);if(!d.length)return!1;q=d;A=this;r="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:r,node:q,inst:A}},can_paste:function(){return!1!==r&&!1!==q},paste:function(a,d){a=this.get_node(a);if(!(a&&r&&r.match(/^(copy_node|move_node)$/)&&q))return!1;this[r](q,a,d,!1,!1,!1,A)&&this.trigger("paste",{parent:a.id,node:q,mode:r});A=r=q=!1},clear_buffer:function(){A=r=q=!1;this.trigger("clear_buffer")},edit:function(a,d,b){var c=!1;a=this.get_node(a);
if(!a)return!1;if(!this.check("edit",a,this.get_parent(a)))return this.settings.core.error.call(this,this._data.core.last_error),!1;var e=a;d="string"===typeof d?d:a.text;this.set_text(a,"");a=this._open_to(a);e.text=d;var h=this._data.core.rtl;var g=this.element.width();this._data.core.focused=e.id;var k=a.children(".jstree-anchor").trigger("focus");var l=f("<span></span>");var m=d;var n=f("<div></div>",{css:{position:"absolute",top:"-200px",left:h?"0px":"-1000px",visibility:"hidden"}}).appendTo(x.body);
var t=f("<input />",{value:m,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(u){u.stopImmediatePropagation();u.preventDefault();u=l.children(".jstree-rename-input").val();var v=this.settings.core.force_text;""===u&&(u=m);n.remove();l.replaceWith(k);l.remove();m=v?m:f("<div></div>").append(f.parseHTML(m)).html();a=this.get_node(a);
this.set_text(a,m);(v=!!this.rename_node(a,v?f("<div></div>").text(u).text():f("<div></div>").append(f.parseHTML(u)).html()))||this.set_text(a,m);this._data.core.focused=e.id;setTimeout(function(){var y=this.get_node(e.id,!0);y.length&&(this._data.core.focused=e.id,y.children(".jstree-anchor").trigger("focus"))}.bind(this),0);b&&b.call(this,e,v,c,u);t=null}.bind(this),keydown:function(u){var v=u.which;27===v&&(c=!0,this.value=m);27!==v&&13!==v&&37!==v&&38!==v&&39!==v&&40!==v&&32!==v||u.stopImmediatePropagation();
if(27===v||13===v)u.preventDefault(),this.blur()},click:function(u){u.stopImmediatePropagation()},mousedown:function(u){u.stopImmediatePropagation()},keyup:function(u){t.width(Math.min(n.text("pW"+this.value).width(),g))},keypress:function(u){if(13===u.which)return!1}});d={fontFamily:k.css("fontFamily")||"",fontSize:k.css("fontSize")||"",fontWeight:k.css("fontWeight")||"",fontStyle:k.css("fontStyle")||"",fontStretch:k.css("fontStretch")||"",fontVariant:k.css("fontVariant")||"",letterSpacing:k.css("letterSpacing")||
"",wordSpacing:k.css("wordSpacing")||""};l.attr("class",k.attr("class")).append(k.contents().clone()).append(t);k.replaceWith(l);n.css(d);t.css(d).width(Math.min(n.text("pW"+t[0].value).width(),g))[0].select();f(x).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(u){t&&u.target!==t&&f(t).trigger("blur")})},set_theme:function(a,d){if(!a)return!1;!0===d&&((d=this.settings.core.themes.dir)||(d=f.jstree.path+"/themes"),d=d+"/"+a+"/style.css");d&&-1===f.inArray(d,w)&&(f("head").append('<link rel="stylesheet" href="'+
d+'" type="text/css" />'),w.push(d));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+
"-"+this._data.core.themes.variant);(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped");this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped");this.trigger("hide_stripes")},
toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots");this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots");this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;
this.get_container_ul().removeClass("jstree-no-icons");this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons");this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0;this.get_container_ul().addClass("jstree-ellipsis");this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=
!1;this.get_container_ul().removeClass("jstree-ellipsis");this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(a,d){var b;if(f.vakata.is_array(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.set_icon(a[c],d);return!0}a=this.get_node(a);if(!a||a.id===f.jstree.root)return!1;b=a.icon;a.icon=!0===d||null===d||d===z||""===d?!0:d;c=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");
!1===d?(c.removeClass("jstree-themeicon-custom "+b).css("background","").removeAttr("rel"),this.hide_icon(a)):(!0===d||null===d||d===z||""===d?c.removeClass("jstree-themeicon-custom "+b).css("background","").removeAttr("rel"):-1===d.indexOf("/")&&-1===d.indexOf(".")?(c.removeClass(b).css("background",""),c.addClass(d+" jstree-themeicon-custom").attr("rel",d)):(c.removeClass(b).css("background",""),c.addClass("jstree-themeicon-custom").css("background","url('"+d+"') center center no-repeat").attr("rel",
d)),!1===b&&this.show_icon(a));return!0},get_icon:function(a){return(a=this.get_node(a))&&a.id!==f.jstree.root?a.icon:!1},hide_icon:function(a){var d;if(f.vakata.is_array(a)){a=a.slice();var b=0;for(d=a.length;b<d;b++)this.hide_icon(a[b]);return!0}a=this.get_node(a);if(!a||a===f.jstree.root)return!1;a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var d;if(f.vakata.is_array(a)){a=a.slice();var b=
0;for(d=a.length;b<d;b++)this.show_icon(a[b]);return!0}a=this.get_node(a);if(!a||a===f.jstree.root)return!1;b=this.get_node(a,!0);a.icon=b.length?b.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);b.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return!0}};f.vakata={};f.vakata.attributes=function(a,d){a=f(a)[0];var b=d?{}:[];a&&a.attributes&&f.each(a.attributes,function(c,e){-1===f.inArray(e.name.toLowerCase(),
["style","contenteditable","hasfocus","tabindex"])&&null!==e.value&&""!==f.vakata.trim(e.value)&&(d?b[e.name]=e.value:b.push(e.name))});return b};f.vakata.array_unique=function(a){var d=[],b,c={};var e=0;for(b=a.length;e<b;e++)c[a[e]]===z&&(d.push(a[e]),c[a[e]]=!0);return d};f.vakata.array_remove=function(a,d){a.splice(d,1);return a};f.vakata.array_remove_item=function(a,d){d=f.inArray(d,a);return-1!==d?f.vakata.array_remove(a,d):a};f.vakata.array_filter=function(a,d,b,c,e){if(a.filter)return a.filter(d,
b);c=[];for(e in a)~~e+""===e+""&&0<=e&&d.call(b,a[e],+e,a)&&c.push(a[e]);return c};f.vakata.trim=function(a){return String.prototype.trim?String.prototype.trim.call(a.toString()):a.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};f.vakata.is_function=function(a){return"function"===typeof a&&"number"!==typeof a.nodeType};f.vakata.is_array=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};Function.prototype.bind||(Function.prototype.bind=function(){var a=
this,d=arguments[0],b=Array.prototype.slice.call(arguments,1);if("function"!==typeof a)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var c=b.concat(Array.prototype.slice.call(arguments));return a.apply(d,c)}});f.jstree.plugins.changed=function(a,d){var b=[];this.trigger=function(c,e){var h;e||(e={});if("changed"===c.replace(".jstree","")){e.changed={selected:[],deselected:[]};var g={};var k=0;for(h=b.length;k<h;k++)g[b[k]]=1;k=0;for(h=
e.selected.length;k<h;k++)g[e.selected[k]]?g[e.selected[k]]=2:e.changed.selected.push(e.selected[k]);k=0;for(h=b.length;k<h;k++)1===g[b[k]]&&e.changed.deselected.push(b[k]);b=e.selected.slice()}d.trigger.call(this,c,e)};this.refresh=function(c,e){b=[];return d.refresh.apply(this,arguments)}};var I=x.createElement("I");I.className="jstree-icon jstree-checkbox";I.setAttribute("role","presentation");f.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",
tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0};f.jstree.plugins.checkbox=function(a,d){this.bind=function(){d.bind.call(this);this._data.checkbox.uto=!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&
this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=
setTimeout(this._undetermined.bind(this),50)}.bind(this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",function(b,c){b=this._model.data;c=c.nodes;var e;var h=0;for(e=c.length;h<e;h++)b[c[h]].state.checked=b[c[h]].state.checked||b[c[h]].original&&b[c[h]].original.state&&b[c[h]].original.state.checked,b[c[h]].state.checked&&this._data.checkbox.selected.push(c[h])}.bind(this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",
function(b,c){b=this._model.data;var e=b[c.parent],h=c.nodes;c=[];var g,k,l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))if(e.state[m?"selected":"checked"]){var n=0;for(g=h.length;n<g;n++)b[h[n]].state[m?"selected":"checked"]=!0;this._data[m?"core":"checkbox"].selected=this._data[m?"core":"checkbox"].selected.concat(h)}else for(n=0,g=h.length;n<g;n++)if(b[h[n]].state[m?"selected":"checked"]){var t=0;for(k=b[h[n]].children_d.length;t<k;t++)b[b[h[n]].children_d[t]].state[m?
"selected":"checked"]=!0;this._data[m?"core":"checkbox"].selected=this._data[m?"core":"checkbox"].selected.concat(b[h[n]].children_d)}if(-1!==l.indexOf("up")){n=0;for(g=e.children_d.length;n<g;n++)b[e.children_d[n]].children.length||c.push(b[e.children_d[n]].parent);c=f.vakata.array_unique(c);t=0;for(k=c.length;t<k;t++)for(e=b[c[t]];e&&e.id!==f.jstree.root;){n=h=0;for(g=e.children.length;n<g;n++)h+=b[e.children[n]].state[m?"selected":"checked"];if(h===g)e.state[m?"selected":"checked"]=!0,this._data[m?
"core":"checkbox"].selected.push(e.id),(n=this.get_node(e,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked");else break;e=this.get_node(e.parent)}}this._data[m?"core":"checkbox"].selected=f.vakata.array_unique(this._data[m?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(b,c){var e=c.node;b=this._model.data;c=this.get_node(e.parent);var h;var g=this.settings.checkbox.cascade;
var k=this.settings.checkbox.tie_selection,l={},m=this._data[k?"core":"checkbox"].selected;var n=0;for(h=m.length;n<h;n++)l[m[n]]=!0;if(-1!==g.indexOf("down"))for(m=this._cascade_new_checked_state(e.id,!0),e=e.children_d.concat(e.id),n=0,h=e.length;n<h;n++)-1<m.indexOf(e[n])?l[e[n]]=!0:delete l[e[n]];if(-1!==g.indexOf("up"))for(;c&&c.id!==f.jstree.root;){n=g=0;for(h=c.children.length;n<h;n++)g+=b[c.children[n]].state[k?"selected":"checked"];if(g===h)c.state[k?"selected":"checked"]=!0,l[c.id]=!0,(h=
this.get_node(c,!0))&&h.length&&h.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}m=[];for(n in l)l.hasOwnProperty(n)&&m.push(n);this._data[k?"core":"checkbox"].selected=m}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(b,c){b=this.get_node(f.jstree.root);c=this._model.data;var e,h;var g=0;for(e=b.children_d.length;g<e;g++)(h=c[b.children_d[g]])&&h.original&&
h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(b,c){var e=c.node;this.get_node(e,!0);var h;var g=this.settings.checkbox.cascade;b=this.settings.checkbox.tie_selection;c=this._data[b?"core":"checkbox"].selected;var k=e.children_d.concat(e.id);if(-1!==g.indexOf("down")){var l=this._cascade_new_checked_state(e.id,!1);c=f.vakata.array_filter(c,function(n){return-1===
k.indexOf(n)||-1<l.indexOf(n)})}if(-1!==g.indexOf("up")&&-1===c.indexOf(e.id)){g=0;for(h=e.parents.length;g<h;g++){var m=this._model.data[e.parents[g]];m.state[b?"selected":"checked"]=!1;m&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1);(m=this.get_node(e.parents[g],!0))&&m.length&&m.attr("aria-selected",!1).children(".jstree-anchor").removeClass(b?"jstree-clicked":"jstree-checked")}c=f.vakata.array_filter(c,function(n){return-1===e.parents.indexOf(n)})}this._data[b?
"core":"checkbox"].selected=c}.bind(this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",function(b,c){b=this.get_node(c.parent);c=this._model.data;for(var e,h,g,k=this.settings.checkbox.tie_selection;b&&b.id!==f.jstree.root&&!b.state[k?"selected":"checked"];){e=g=0;for(h=b.children.length;e<h;e++)g+=c[b.children[e]].state[k?"selected":"checked"];if(0<h&&g===h)b.state[k?"selected":"checked"]=!0,this._data[k?"core":"checkbox"].selected.push(b.id),(e=this.get_node(b,
!0))&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}}.bind(this)).on("move_node.jstree",function(b,c){var e=c.is_multi,h=c.old_parent;c=this.get_node(c.parent);b=this._model.data;var g,k=this.settings.checkbox.tie_selection;if(!e)for(e=this.get_node(h);e&&e.id!==f.jstree.root&&!e.state[k?"selected":"checked"];){var l=h=0;for(g=e.children.length;l<g;l++)h+=b[e.children[l]].state[k?"selected":"checked"];
if(0<g&&h===g)e.state[k?"selected":"checked"]=!0,this._data[k?"core":"checkbox"].selected.push(e.id),(h=this.get_node(e,!0))&&h.length&&h.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":"jstree-checked");else break;e=this.get_node(e.parent)}for(e=c;e&&e.id!==f.jstree.root;){l=h=0;for(g=e.children.length;l<g;l++)h+=b[e.children[l]].state[k?"selected":"checked"];if(h===g)e.state[k?"selected":"checked"]||(e.state[k?"selected":"checked"]=!0,this._data[k?"core":"checkbox"].selected.push(e.id),
(h=this.get_node(e,!0))&&h.length&&h.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":"jstree-checked"));else if(e.state[k?"selected":"checked"])e.state[k?"selected":"checked"]=!1,this._data[k?"core":"checkbox"].selected=f.vakata.array_remove_item(this._data[k?"core":"checkbox"].selected,e.id),(h=this.get_node(e,!0))&&h.length&&h.attr("aria-selected",!1).children(".jstree-anchor").removeClass(k?"jstree-clicked":"jstree-checked");else break;e=this.get_node(e.parent)}}.bind(this))};
this.get_undetermined=function(b){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];var c,e,h={},g=this._model.data,k=this.settings.checkbox.tie_selection,l=this._data[k?"core":"checkbox"].selected,m=[],n=this,t=[];var u=0;for(c=l.length;u<c;u++)if(g[l[u]]&&g[l[u]].parents){var v=0;for(e=g[l[u]].parents.length;v<e&&h[g[l[u]].parents[v]]===z;v++)g[l[u]].parents[v]!==f.jstree.root&&(h[g[l[u]].parents[v]]=!0,m.push(g[l[u]].parents[v]))}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var y=
n.get_node(this);if(y)if(y.state.loaded)for(u=0,c=y.children_d.length;u<c;u++){var p=g[y.children_d[u]];if(!p.state.loaded&&p.original&&p.original.state&&p.original.state.undetermined&&!0===p.original.state.undetermined)for(h[p.id]===z&&p.id!==f.jstree.root&&(h[p.id]=!0,m.push(p.id)),v=0,e=p.parents.length;v<e;v++)h[p.parents[v]]===z&&p.parents[v]!==f.jstree.root&&(h[p.parents[v]]=!0,m.push(p.parents[v]))}else if(y.original&&y.original.state&&y.original.state.undetermined&&!0===y.original.state.undetermined)for(h[y.id]===
z&&y.id!==f.jstree.root&&(h[y.id]=!0,m.push(y.id)),v=0,e=y.parents.length;v<e;v++)h[y.parents[v]]===z&&y.parents[v]!==f.jstree.root&&(h[y.parents[v]]=!0,m.push(y.parents[v]))});u=0;for(c=m.length;u<c;u++)g[m[u]].state[k?"selected":"checked"]||t.push(b?g[m[u]]:m[u]);return t};this._undetermined=function(){if(null!==this.element){var b=this.get_undetermined(!1),c,e;this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");var h=0;for(c=b.length;h<c;h++)(e=this.get_node(b[h],!0))&&
e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}};this.redraw_node=function(b,c,e,h){if(b=d.redraw_node.apply(this,arguments)){var g,k=null;var l=0;for(g=b.childNodes.length;l<g;l++)if(b.childNodes[l]&&b.childNodes[l].className&&-1!==b.childNodes[l].className.indexOf("jstree-anchor")){k=b.childNodes[l];break}k&&(!this.settings.checkbox.tie_selection&&this._model.data[b.id].state.checked&&(k.className+=" jstree-checked"),l=I.cloneNode(!1),this._model.data[b.id].state.checkbox_disabled&&
(l.className+=" jstree-checkbox-disabled"),k.insertBefore(l,k.childNodes[0]))}e||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50));return b};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};
this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(b){b=this.get_node(b);var c=this.settings.checkbox.cascade;var e=this.settings.checkbox.tie_selection;var h=this._data[e?"core":"checkbox"].selected,g=this._model.data;if(!b||!0===b.state[e?"selected":"checked"]||-1===c.indexOf("undetermined")||-1===c.indexOf("down")&&-1===c.indexOf("up"))return!1;if(!b.state.loaded&&!0===b.original.state.undetermined)return!0;
c=0;for(e=b.children_d.length;c<e;c++)if(-1!==f.inArray(b.children_d[c],h)||!g[b.children_d[c]].state.loaded&&g[b.children_d[c]].original.state.undetermined)return!0;return!1};this.disable_checkbox=function(b){var c;if(f.vakata.is_array(b)){b=b.slice();var e=0;for(c=b.length;e<c;e++)this.disable_checkbox(b[e]);return!0}b=this.get_node(b);if(!b||b.id===f.jstree.root)return!1;e=this.get_node(b,!0);b.state.checkbox_disabled||(b.state.checkbox_disabled=!0,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),
this.trigger("disable_checkbox",{node:b}))};this.enable_checkbox=function(b){var c;if(f.vakata.is_array(b)){b=b.slice();var e=0;for(c=b.length;e<c;e++)this.enable_checkbox(b[e]);return!0}b=this.get_node(b);if(!b||b.id===f.jstree.root)return!1;e=this.get_node(b,!0);b.state.checkbox_disabled&&(b.state.checkbox_disabled=!1,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:b}))};this.activate_node=function(b,
c){if(f(c.target).hasClass("jstree-checkbox-disabled"))return!1;this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||f(c.target).hasClass("jstree-checkbox"))&&(c.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!f(c.target).hasClass("jstree-checkbox"))return d.activate_node.call(this,b,c);if(this.is_disabled(b))return!1;this.is_checked(b)?this.uncheck_node(b,c):this.check_node(b,c);this.trigger("activate_node",{node:this.get_node(b)})};
this._cascade_new_checked_state=function(b,c){var e=this.settings.checkbox.tie_selection,h=this._model.data[b],g=[],k=[],l;if(!this.settings.checkbox.cascade_to_disabled&&h.state.disabled||!this.settings.checkbox.cascade_to_hidden&&h.state.hidden){var m=this.get_checked_descendants(b);h.state[e?"selected":"checked"]&&m.push(h.id);g=g.concat(m)}else{if(h.children)for(b=0,l=h.children.length;b<l;b++){var n=h.children[b];m=this._cascade_new_checked_state(n,c);g=g.concat(m);-1<m.indexOf(n)&&k.push(n)}b=
this.get_node(h,!0);l=0<k.length&&k.length<h.children.length;h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=l);l?(h.state[e?"selected":"checked"]=!1,b.attr("aria-selected",!1).children(".jstree-anchor").removeClass(e?"jstree-clicked":"jstree-checked")):c&&k.length===h.children.length?(h.state[e?"selected":"checked"]=c,g.push(h.id),b.attr("aria-selected",!0).children(".jstree-anchor").addClass(e?"jstree-clicked":"jstree-checked")):(h.state[e?"selected":
"checked"]=!1,b.attr("aria-selected",!1).children(".jstree-anchor").removeClass(e?"jstree-clicked":"jstree-checked"))}return g};this.get_checked_descendants=function(b){var c=this,e=c.settings.checkbox.tie_selection;return f.vakata.array_filter(c._model.data[b].children_d,function(h){return c._model.data[h].state[e?"selected":"checked"]})};this.check_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.select_node(b,!1,!0,c);var e;if(f.vakata.is_array(b)){b=b.slice();var h=0;for(e=
b.length;h<e;h++)this.check_node(b[h],c);return!0}b=this.get_node(b);if(!b||b.id===f.jstree.root)return!1;h=this.get_node(b,!0);b.state.checked||(b.state.checked=!0,this._data.checkbox.selected.push(b.id),h&&h.length&&h.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:b,selected:this._data.checkbox.selected,event:c}))};this.uncheck_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(b,!1,c);var e;if(f.vakata.is_array(b)){b=b.slice();
var h=0;for(e=b.length;h<e;h++)this.uncheck_node(b[h],c);return!0}b=this.get_node(b);if(!b||b.id===f.jstree.root)return!1;h=this.get_node(b,!0);b.state.checked&&(b.state.checked=!1,this._data.checkbox.selected=f.vakata.array_remove_item(this._data.checkbox.selected,b.id),h.length&&h.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:b,selected:this._data.checkbox.selected,event:c}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();
this._data.checkbox.selected.concat([]);var b;this._data.checkbox.selected=this._model.data[f.jstree.root].children_d.concat();var c=0;for(b=this._data.checkbox.selected.length;c<b;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var b=this._data.checkbox.selected.concat([]),
c;var e=0;for(c=this._data.checkbox.selected.length;e<c;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:b})};this.is_checked=function(b){return this.settings.checkbox.tie_selection?this.is_selected(b):(b=this.get_node(b))&&b.id!==f.jstree.root?b.state.checked:
!1};this.get_checked=function(b){return this.settings.checkbox.tie_selection?this.get_selected(b):b?f.map(this._data.checkbox.selected,function(c){return this.get_node(c)}.bind(this)):this._data.checkbox.selected.slice()};this.get_top_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_top_selected(b);var c=this.get_checked(!0),e={},h,g;var k=0;for(h=c.length;k<h;k++)e[c[k].id]=c[k];k=0;for(h=c.length;k<h;k++){var l=0;for(g=c[k].children_d.length;l<g;l++)e[c[k].children_d[l]]&&
delete e[c[k].children_d[l]]}c=[];for(k in e)e.hasOwnProperty(k)&&c.push(k);return b?f.map(c,function(m){return this.get_node(m)}.bind(this)):c};this.get_bottom_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(b);var c=this.get_checked(!0),e=[],h;var g=0;for(h=c.length;g<h;g++)c[g].children.length||e.push(c[g].id);return b?f.map(e,function(k){return this.get_node(k)}.bind(this)):e};this.load_node=function(b,c){var e,h;if(!f.vakata.is_array(b)&&!this.settings.checkbox.tie_selection&&
(h=this.get_node(b))&&h.state.loaded){var g=0;for(e=h.children_d.length;g<e;g++)this._model.data[h.children_d[g]].state.checked&&(this._data.checkbox.selected=f.vakata.array_remove_item(this._data.checkbox.selected,h.children_d[g]))}return d.load_node.apply(this,arguments)};this.get_state=function(){var b=d.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection)return b;b.checkbox=this._data.checkbox.selected.slice();return b};this.set_state=function(b,c){var e=d.set_state.apply(this,
arguments);if(e&&b.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var h=this;f.each(b.checkbox,function(g,k){h.check_node(k)})}delete b.checkbox;this.set_state(b,c);return!1}return e};this.refresh=function(b,c){this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]);return d.refresh.apply(this,arguments)}};f.jstree.defaults.conditionalselect=function(){return!0};f.jstree.plugins.conditionalselect=function(a,d){this.activate_node=function(b,c){if(this.settings.conditionalselect.call(this,
this.get_node(b),c))return d.activate_node.call(this,b,c)}};f.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,d){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(b){var c=f.jstree.reference(b.reference);b=c.get_node(b.reference);c.create_node(b,{},"last",function(e){try{c.edit(e)}catch(h){setTimeout(function(){c.edit(e)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(b){var c=
f.jstree.reference(b.reference);b=c.get_node(b.reference);c.edit(b)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(b){var c=f.jstree.reference(b.reference);b=c.get_node(b.reference);c.is_selected(b)?c.delete_node(c.get_selected()):c.delete_node(b)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(b){var c=f.jstree.reference(b.reference);
b=c.get_node(b.reference);c.is_selected(b)?c.cut(c.get_top_selected()):c.cut(b)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(b){var c=f.jstree.reference(b.reference);b=c.get_node(b.reference);c.is_selected(b)?c.copy(c.get_top_selected()):c.copy(b)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!f.jstree.reference(b.reference).can_paste()},separator_after:!1,label:"Paste",action:function(b){var c=f.jstree.reference(b.reference);b=c.get_node(b.reference);
c.paste(b)}}}}}}};f.jstree.plugins.contextmenu=function(a,d){this.bind=function(){d.bind.call(this);var b=0,c=null,e,h;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(g,k){if("input"!==g.target.tagName.toLowerCase()){g.preventDefault();b=g.ctrlKey?+new Date:0;if(k||c)b=+new Date+1E4;c&&clearTimeout(c);this.is_loading(g.currentTarget)||this.show_contextmenu(g.currentTarget,
g.pageX,g.pageY,g)}}.bind(this)).on("click.jstree",".jstree-anchor",function(g){this._data.contextmenu.visible&&(!b||250<+new Date-b)&&f.vakata.context.hide();b=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",function(g){g.originalEvent&&g.originalEvent.changedTouches&&g.originalEvent.changedTouches[0]&&(e=g.originalEvent.changedTouches[0].clientX,h=g.originalEvent.changedTouches[0].clientY,c=setTimeout(function(){f(g.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",
function(g){c&&g.originalEvent&&g.originalEvent.changedTouches&&g.originalEvent.changedTouches[0]&&(10<Math.abs(e-g.originalEvent.changedTouches[0].clientX)||10<Math.abs(h-g.originalEvent.changedTouches[0].clientY))&&(clearTimeout(c),f.vakata.context.hide())}).on("touchend.vakata.jstree",function(g){c&&clearTimeout(c)});f(x).on("context_hide.vakata.jstree",function(g,k){this._data.contextmenu.visible=!1;f(k.reference).removeClass("jstree-context")}.bind(this))};this.teardown=function(){this._data.contextmenu.visible&&
f.vakata.context.hide();f(x).off("context_hide.vakata.jstree");d.teardown.call(this)};this.show_contextmenu=function(b,c,e,h){b=this.get_node(b);if(!b||b.id===f.jstree.root)return!1;var g=this.settings.contextmenu,k=this.get_node(b,!0).children(".jstree-anchor"),l=!1;l=!1;if(g.show_at_node||c===z||e===z)l=k.offset(),c=l.left,e=l.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(b)&&this.activate_node(b,h);l=g.items;f.vakata.is_function(l)&&(l=l.call(this,b,function(m){this._show_contextmenu(b,
c,e,m)}.bind(this)));f.isPlainObject(l)&&this._show_contextmenu(b,c,e,l)};this._show_contextmenu=function(b,c,e,h){var g=this.get_node(b,!0).children(".jstree-anchor");f(x).one("context_show.vakata.jstree",function(k,l){k="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";f(l.element).addClass(k);g.addClass("jstree-context")}.bind(this));this._data.contextmenu.visible=!0;f.vakata.context.show(g,{x:c,y:e},h);this.trigger("show_contextmenu",{node:b,x:c,y:e})}};(function(a){var d=!1,b=!1,c=
!1,e=0,h=0,g=[],k="",l=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(m){a(x).triggerHandler("context_"+m+".vakata",{reference:c,element:b,position:{x:e,y:h}})},_execute:function(m){return(m=g[m])&&(!m._disabled||a.vakata.is_function(m._disabled)&&!m._disabled({item:m,reference:c,element:b}))&&m.action?m.action.call(null,{item:m,reference:c,element:b,position:{x:e,y:h}}):!1},_parse:function(m,n){if(!m)return!1;n||(k="",g=[]);var t="",u=!1,v;n&&(t+="<ul>");a.each(m,
function(y,p){if(!p)return!0;g.push(p);!u&&p.separator_before&&(t+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>");u=!1;t+="<li class='"+(p._class||"")+(!0===p._disabled||a.vakata.is_function(p._disabled)&&p._disabled({item:p,reference:c,element:b})?" vakata-contextmenu-disabled ":"")+"' "+(p.shortcut?" data-shortcut='"+p.shortcut+"' ":"")+">";t+="<a href='#' rel='"+(g.length-1)+"' "+(p.title?"title='"+
p.title+"'":"")+">";a.vakata.context.settings.icons&&(t+="<i ",p.icon&&(t=-1!==p.icon.indexOf("/")||-1!==p.icon.indexOf(".")?t+(" style='background:url(\""+p.icon+"\") center center no-repeat' "):t+(" class='"+p.icon+"' ")),t+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");t+=(a.vakata.is_function(p.label)?p.label({item:y,reference:c,element:b}):p.label)+(p.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+p.shortcut+'">'+(p.shortcut_label||"")+"</span>":
"")+"</a>";p.submenu&&(v=a.vakata.context._parse(p.submenu,!0))&&(t+=v);t+="</li>";p.separator_after&&(t+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",u=!0)});t=t.replace(/<li class='vakata-context-separator'><\/li>$/,"");n&&(t+="</ul>");n||(k=t,a.vakata.context._trigger("parse"));return 10<t.length?t:!1},_show_submenu:function(m){m=a(m);if(m.length&&m.children("ul").length){var n=m.children("ul"),t=m.offset().left,
u=t+m.outerWidth(),v=m.offset().top,y=n.width(),p=n.height(),D=a(window).width()+a(window).scrollLeft(),K=a(window).height()+a(window).scrollTop();if(d)m[0>u-(y+10+m.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else m[u+y>D&&t>D-u?"addClass":"removeClass"]("vakata-context-right");v+p+10>K&&n.css("bottom","-1px");m.hasClass("vakata-context-right")?t<y&&n.css("margin-right",t-y):D-u<y&&n.css("margin-left",D-u-y);n.show()}},show:function(m,n,t){b&&b.length&&b.width("");switch(!0){case !n&&
!m:return!1;case !!n&&!!m:c=m;e=n.x;h=n.y;break;case !n&&!!m:c=m;n=m.offset();e=n.left+m.outerHeight();h=n.top;break;case !!n&&!m:e=n.x,h=n.y}m&&!t&&a(m).data("vakata_contextmenu")&&(t=a(m).data("vakata_contextmenu"));a.vakata.context._parse(t)&&b.html(k);if(g.length){b.appendTo(x.body);t=b;n=e;var u=h;var v=t.width();var y=t.height();var p=a(window).width()+a(window).scrollLeft();var D=a(window).height()+a(window).scrollTop();d&&(n-=t.outerWidth()-a(m).outerWidth(),n<a(window).scrollLeft()+20&&(n=
a(window).scrollLeft()+20));n+v+20>p&&(n=p-(v+20));u+y+20>D&&(u=D-(y+20));b.css({left:n,top:u}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover");l=!0;a.vakata.context._trigger("show")}},hide:function(){l&&(b.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),l=!1,a.vakata.context._trigger("hide"))}};a(function(){d="rtl"===a(x.body).css("direction");var m=!1;b=a("<ul class='vakata-context'></ul>");b.on("mouseenter","li",function(n){n.stopImmediatePropagation();
a.contains(this,n.relatedTarget)||(m&&clearTimeout(m),b.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(n){a.contains(this,n.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(n){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
a.vakata.context.settings.hide_onmouseleave&&(m=setTimeout(function(t){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(n){n.preventDefault();a(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(n){switch(n.which){case 13:case 32:n.type="click";n.preventDefault();a(n.currentTarget).trigger(n);break;case 37:l&&
(b.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 38:if(l){var t=b.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();t.length||(t=b.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last());
t.addClass("vakata-context-hover").children("a").trigger("focus");n.stopImmediatePropagation();n.preventDefault()}break;case 39:l&&(b.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 40:l&&(t=b.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),
t.length||(t=b.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),t.addClass("vakata-context-hover").children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 27:a.vakata.context.hide(),n.preventDefault()}}).on("keydown",function(n){n.preventDefault();n=b.find(".vakata-contextmenu-shortcut-"+n.which).parent();n.parent().not(".vakata-context-disabled")&&n.trigger("click")});a(x).on("mousedown.vakata.jstree",function(n){l&&b[0]!==
n.target&&!a.contains(b[0],n.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(n,t){b.find("li:has(ul)").children("a").addClass("vakata-context-parent");d&&b.addClass("vakata-context-rtl").css("direction","rtl");b.find("ul").hide().end()})})})(f);f.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var N,Q;f.jstree.plugins.dnd=
function(a,d){this.init=function(b,c){d.init.call(this,b,c);this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in x.createElement("span")};this.bind=function(){d.bind.call(this);this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(b){if(this.settings.dnd.large_drag_target&&f(b.target).closest(".jstree-node")[0]!==b.currentTarget||"touchstart"===b.type&&(!this.settings.dnd.touch||
"selected"===this.settings.dnd.touch&&!f(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var c=this.get_node(b.target),e=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,h=1<e?e+" "+this.get_string("nodes"):this.get_text(b.currentTarget);this.settings.core.force_text&&(h=f.vakata.html.escape(h));if(c&&c.id&&c.id!==f.jstree.root&&(1===b.which||"touchstart"===b.type||"dragstart"===b.type)&&(!0===this.settings.dnd.is_draggable||
f.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<e?this.get_top_selected(!0):[c],b)))if(N={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:1<e?this.get_top_selected():[c.id]},Q=b.currentTarget,this.settings.dnd.use_html5)f.vakata.dnd._trigger("start",b,{helper:f(),element:Q,data:N});else return this.element.trigger("mousedown.jstree"),f.vakata.dnd.start(b,N,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+
" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+h+'<ins class="jstree-copy">+</ins></div>')}.bind(this));if(this.settings.dnd.use_html5)this.element.on("dragover.jstree",function(b){b.preventDefault();f.vakata.dnd._trigger("move",b,{helper:f(),element:Q,data:N});return!1}).on("drop.jstree",function(b){b.preventDefault();f.vakata.dnd._trigger("stop",b,{helper:f(),element:Q,data:N});return!1}.bind(this))};this.redraw_node=function(b,c,
e,h){if((b=d.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)b.setAttribute("draggable",!0);else{var g,k=null;var l=0;for(g=b.childNodes.length;l<g;l++)if(b.childNodes[l]&&b.childNodes[l].className&&-1!==b.childNodes[l].className.indexOf("jstree-anchor")){k=b.childNodes[l];break}k&&k.setAttribute("draggable",!0)}return b}};f(function(){var a=!1,d=!1,b=!1,c=!1,e=f('<div id="jstree-marker">&#160;</div>').hide();f(x).on("dragover.vakata.jstree",
function(h){Q&&f.vakata.dnd._trigger("move",h,{helper:f(),element:Q,data:N})}).on("drop.vakata.jstree",function(h){Q&&(f.vakata.dnd._trigger("stop",h,{helper:f(),element:Q,data:N}),N=Q=null)}).on("dnd_start.vakata.jstree",function(h,g){b=a=!1;g&&g.data&&g.data.jstree&&e.appendTo(x.body)}).on("dnd_move.vakata.jstree",function(h,g){var k=g.event.target!==b.target;c&&(!g.event||"dragover"!==g.event.type||k)&&clearTimeout(c);if(g&&g.data&&g.data.jstree&&(!g.event.target.id||"jstree-marker"!==g.event.target.id)){b=
g.event;var l=f.jstree.reference(g.event.target),m=!1,n=!1;h=!1;var t,u,v,y,p,D,K,T,L,R,O,P;if(l&&l._data&&l._data.dnd){e.attr("class","jstree-"+l.get_theme()+(l.settings.core.themes.responsive?" jstree-dnd-responsive":""));var X=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey));g.helper.children().attr("class","jstree-"+l.get_theme()+" jstree-"+l.get_theme()+"-"+l.get_theme_variant()+" "+(l.settings.core.themes.responsive?
" jstree-dnd-responsive":"")).find(".jstree-copy").first()[X?"show":"hide"]();if(g.event.target!==l.element[0]&&g.event.target!==l.get_container_ul()[0]||0!==l.get_container_ul().children().length){if((m=l.settings.dnd.large_drop_target?f(g.event.target).closest(".jstree-node").children(".jstree-anchor"):f(g.event.target).closest(".jstree-anchor"))&&m.length&&m.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){n=m.offset();h=(g.event.pageY!==z?g.event.pageY:g.event.originalEvent.pageY)-n.top;
var J=m.outerHeight();var Y=h<J/3?["b","i","a"]:h>J-J/3?["a","i","b"]:h>J/2?["i","a","b"]:["i","b","a"];f.each(Y,function(W,U){switch(U){case "b":t=n.left-6;u=n.top;v=l.get_parent(m);y=m.parent().index();P="jstree-below";break;case "i":L=l.settings.dnd.inside_pos;R=l.get_node(m.parent());t=n.left-2;u=n.top+J/2+1;v=R.id;y="first"===L?0:"last"===L?R.children.length:Math.min(L,R.children.length);P="jstree-inside";break;case "a":t=n.left-6,u=n.top+J,v=l.get_parent(m),y=m.parent().index()+1,P="jstree-above"}C=
!0;E=0;for(p=g.data.nodes.length;E<p;E++)if(D=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",K=y,"move_node"===D&&"a"===U&&g.data.origin&&g.data.origin===l&&v===l.get_parent(g.data.nodes[E])&&(T=l.get_node(v),K>f.inArray(g.data.nodes[E],T.children)&&--K),C=C&&(l&&l.settings&&l.settings.dnd&&!1===l.settings.dnd.check_while_dragging||l.check(D,g.data.origin&&g.data.origin!==l?g.data.origin.get_node(g.data.nodes[E]):
g.data.nodes[E],v,K,{dnd:!0,ref:l.get_node(m.parent()),pos:U,origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==l,is_foreign:!g.data.origin})),!C){l&&l.last_error&&(d=l.last_error());break}"i"===U&&m.parent().is(".jstree-closed")&&l.settings.dnd.open_timeout&&(!g.event||"dragover"!==g.event.type||k)&&(c&&clearTimeout(c),c=setTimeout(function(H,Z){return function(){H.open_node(Z)}}(l,m),l.settings.dnd.open_timeout));if(C)return O=l.get_node(v,!0),O.hasClass(".jstree-dnd-parent")||(f(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),
O.addClass("jstree-dnd-parent")),a={ins:l,par:v,pos:"i"!==U||"last"!==L||0!==y||l.is_loaded(R)?y:"last"},e.css({left:t+"px",top:u+"px"}).show(),e.removeClass("jstree-above jstree-inside jstree-below").addClass(P),g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),g.event.originalEvent&&g.event.originalEvent.dataTransfer&&(g.event.originalEvent.dataTransfer.dropEffect=X?"copy":"move"),d={},Y=!0,!1});if(!0===Y)return}}else{var C=!0;var E=0;for(p=g.data.nodes.length;E<
p&&(C=C&&l.check(g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",g.data.origin&&g.data.origin!==l?g.data.origin.get_node(g.data.nodes[E]):g.data.nodes[E],f.jstree.root,"last",{dnd:!0,ref:l.get_node(f.jstree.root),pos:"i",origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==l,is_foreign:!g.data.origin}),C);E++);if(C){a={ins:l,par:f.jstree.root,pos:"last"};e.hide();g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");
g.event.originalEvent&&g.event.originalEvent.dataTransfer&&(g.event.originalEvent.dataTransfer.dropEffect=X?"copy":"move");return}}}f(".jstree-dnd-parent").removeClass("jstree-dnd-parent");a=!1;g.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");e.hide()}}).on("dnd_scroll.vakata.jstree",function(h,g){g&&g.data&&g.data.jstree&&(e.hide(),b=a=!1,g.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(h,g){f(".jstree-dnd-parent").removeClass("jstree-dnd-parent");
c&&clearTimeout(c);if(g&&g.data&&g.data.jstree){e.hide().detach();var k,l=[];if(a){h=0;for(k=g.data.nodes.length;h<k;h++)l[h]=g.data.origin?g.data.origin.get_node(g.data.nodes[h]):g.data.nodes[h];a.ins[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node"](l,a.par,a.pos,!1,!1,!1,g.data.origin)}else h=f(g.event.target).closest(".jstree"),h.length&&d&&d.error&&"check"===d.error&&(h=h.jstree(!0))&&h.settings.core.error.call(this,
d);a=b=!1}}).on("keyup.jstree keydown.jstree",function(h,g){(g=f.vakata.dnd._get())&&g.data&&g.data.jstree&&("keyup"===h.type&&27===h.which?(c&&clearTimeout(c),c=b=d=a=!1,e.hide().detach(),f.vakata.dnd._clean()):(g.helper.find(".jstree-copy").first()[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(h.metaKey||h.ctrlKey))?"show":"hide"](),b&&(b.metaKey=h.metaKey,b.ctrlKey=h.ctrlKey,f.vakata.dnd._trigger("move",b))))})});(function(a){a.vakata.html={div:a("<div></div>"),
escape:function(p){return a.vakata.html.div.text(p).html()},strip:function(p){return a.vakata.html.div.empty().append(a.parseHTML(p)).text()}};var d=!1,b=!1,c=!1,e=!1,h=!1,g=0,k=!1,l=0,m=0,n=0,t=0,u=!1,v=!1,y=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(p,D,K){K===z&&(K=a.vakata.dnd._get());K.event=D;a(x).triggerHandler("dnd_"+p+".vakata",K)},_get:function(){return{data:k,element:d,helper:h}},_clean:function(){h&&
h.remove();v&&(clearInterval(v),v=!1);h=e=c=b=d=!1;g=0;k=!1;t=n=m=l=0;y=v=u=!1;Q=null;a(x).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(x).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(p){if(!u||!n&&!t)return v&&(clearInterval(v),v=!1),!1;if(!v)return v=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===p)return!1;p=u.scrollTop();var D=u.scrollLeft();u.scrollTop(p+t*a.vakata.dnd.settings.scroll_speed);u.scrollLeft(D+n*a.vakata.dnd.settings.scroll_speed);
p===u.scrollTop()&&D===u.scrollLeft()||a.vakata.dnd._trigger("scroll",u)},start:function(p,D,K){"touchstart"===p.type&&p.originalEvent&&p.originalEvent.changedTouches&&p.originalEvent.changedTouches[0]&&(p.pageX=p.originalEvent.changedTouches[0].pageX,p.pageY=p.originalEvent.changedTouches[0].pageY,p.target=x.elementFromPoint(p.originalEvent.changedTouches[0].pageX-window.pageXOffset,p.originalEvent.changedTouches[0].pageY-window.pageYOffset));e&&a.vakata.dnd.stop({});try{p.currentTarget.unselectable=
"on",p.currentTarget.onselectstart=function(){return!1},p.currentTarget.style&&(p.currentTarget.style.touchAction="none",p.currentTarget.style.msTouchAction="none",p.currentTarget.style.MozUserSelect="none")}catch(T){}l=p.pageX;m=p.pageY;k=D;c=!0;d=p.currentTarget;b=p.target;y="touchstart"===p.type;!1!==K&&(h=a("<div id='vakata-dnd'></div>").html(K).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(x).on("mousemove.vakata.jstree touchmove.vakata.jstree",
a.vakata.dnd.drag);a(x).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop);return!1},drag:function(p){"touchmove"===p.type&&p.originalEvent&&p.originalEvent.changedTouches&&p.originalEvent.changedTouches[0]&&(p.pageX=p.originalEvent.changedTouches[0].pageX,p.pageY=p.originalEvent.changedTouches[0].pageY,p.target=x.elementFromPoint(p.originalEvent.changedTouches[0].pageX-window.pageXOffset,p.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(c){if(!e)if(Math.abs(p.pageX-
l)>(y?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(p.pageY-m)>(y?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))h&&(h.appendTo(x.body),g=h.outerWidth()),e=!0,a(b).one("click.vakata",!1),a.vakata.dnd._trigger("start",p);else return;var D=!1,K=!1,T=!1,L=!1,R=!1,O=K=!1,P=!1;L=D=!1;n=t=0;u=!1;a(a(p.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>
this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var X=a(this),J=X.offset();this.scrollHeight>this.offsetHeight&&(J.top+X.height()-p.pageY<a.vakata.dnd.settings.scroll_proximity&&(t=1),p.pageY-J.top<a.vakata.dnd.settings.scroll_proximity&&(t=-1));this.scrollWidth>this.offsetWidth&&(J.left+X.width()-p.pageX<a.vakata.dnd.settings.scroll_proximity&&(n=1),p.pageX-J.left<a.vakata.dnd.settings.scroll_proximity&&(n=-1));if(t||n)return u=a(this),!1});!u&&(D=a(x),K=a(window),T=D.height(),
L=K.height(),R=D.width(),K=K.width(),O=D.scrollTop(),P=D.scrollLeft(),T>L&&p.pageY-O<a.vakata.dnd.settings.scroll_proximity&&(t=-1),T>L&&L-(p.pageY-O)<a.vakata.dnd.settings.scroll_proximity&&(t=1),R>K&&p.pageX-P<a.vakata.dnd.settings.scroll_proximity&&(n=-1),R>K&&K-(p.pageX-P)<a.vakata.dnd.settings.scroll_proximity&&(n=1),t||n)&&(u=D);u&&a.vakata.dnd._scroll(!0);h&&(D=parseInt(p.pageY+a.vakata.dnd.settings.helper_top,10),L=parseInt(p.pageX+a.vakata.dnd.settings.helper_left,10),T&&D+25>T&&(D=T-50),
R&&L+g>R&&(L=R-(g+2)),h.css({left:L+"px",top:D+"px"}));a.vakata.dnd._trigger("move",p);return!1}},stop:function(p){"touchend"===p.type&&p.originalEvent&&p.originalEvent.changedTouches&&p.originalEvent.changedTouches[0]&&(p.pageX=p.originalEvent.changedTouches[0].pageX,p.pageY=p.originalEvent.changedTouches[0].pageY,p.target=x.elementFromPoint(p.originalEvent.changedTouches[0].pageX-window.pageXOffset,p.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(e)p.target!==b&&a(b).off("click.vakata"),
a.vakata.dnd._trigger("stop",p);else if("touchend"===p.type&&p.target===b){var D=setTimeout(function(){a(p.target).trigger("click")},100);a(p.target).one("click",function(){D&&clearTimeout(D)})}a.vakata.dnd._clean();return!1}}})(f);f.jstree.defaults.massload=null;f.jstree.plugins.massload=function(a,d){this.init=function(b,c){this._data.massload={};d.init.call(this,b,c)};this._load_nodes=function(b,c,e,h){var g=this.settings.massload,k=[],l=this._model.data,m,n;if(!e){var t=0;for(m=b.length;t<m;t++)if(!l[b[t]]||
!l[b[t]].state.loaded&&!l[b[t]].state.failed||h)k.push(b[t]),(n=this.get_node(b[t],!0))&&n.length&&n.addClass("jstree-loading").attr("aria-busy",!0);this._data.massload={};if(k.length){if(f.vakata.is_function(g))return g.call(this,k,function(u){if(u)for(v in u)u.hasOwnProperty(v)&&(this._data.massload[v]=u[v]);var v=0;for(u=b.length;v<u;v++)(n=this.get_node(b[v],!0))&&n.length&&n.removeClass("jstree-loading").attr("aria-busy",!1);d._load_nodes.call(this,b,c,e,h)}.bind(this));if("object"===typeof g&&
g&&g.url)return g=f.extend(!0,{},g),f.vakata.is_function(g.url)&&(g.url=g.url.call(this,k)),f.vakata.is_function(g.data)&&(g.data=g.data.call(this,k)),f.ajax(g).done(function(u,v,y){if(u)for(p in u)u.hasOwnProperty(p)&&(this._data.massload[p]=u[p]);var p=0;for(u=b.length;p<u;p++)(n=this.get_node(b[p],!0))&&n.length&&n.removeClass("jstree-loading").attr("aria-busy",!1);d._load_nodes.call(this,b,c,e,h)}.bind(this)).fail(function(u){d._load_nodes.call(this,b,c,e,h)}.bind(this))}}return d._load_nodes.call(this,
b,c,e,h)};this._load_node=function(b,c){var e=this._data.massload[b.id],h=null;return e?(h=this["string"===typeof e?"_append_html_data":"_append_json_data"](b,"string"===typeof e?f(f.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(g){c.call(this,g)}),(e=this.get_node(b.id,!0))&&e.length&&e.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[b.id],h):d._load_node.call(this,b,c)}};f.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,
show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};f.jstree.plugins.search=function(a,d){this.bind=function(){d.bind.call(this);this._data.search.str="";this._data.search.dom=f();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=!1;this._data.search.smc=!1;this._data.search.hdn=[];this.element.on("search.jstree",function(b,c){if(this._data.search.som&&c.res.length){b=this._model.data;var e,h=[],g;var k=0;for(e=c.res.length;k<e;k++)if(b[c.res[k]]&&
!b[c.res[k]].state.hidden&&(h.push(c.res[k]),h=h.concat(b[c.res[k]].parents),this._data.search.smc)){var l=0;for(g=b[c.res[k]].children_d.length;l<g;l++)b[b[c.res[k]].children_d[l]]&&!b[b[c.res[k]].children_d[l]].state.hidden&&h.push(b[c.res[k]].children_d[l])}h=f.vakata.array_remove_item(f.vakata.array_unique(h),f.jstree.root);this._data.search.hdn=this.hide_all(!0);this.show_node(h,!0);this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(b,c){this._data.search.som&&c.res.length&&(this.show_node(this._data.search.hdn,
!0),this.redraw(!0))}.bind(this))};this.search=function(b,c,e,h,g,k){if(!1===b||""===f.vakata.trim(b.toString()))return this.clear_search();h=(h=this.get_node(h))&&h.id?h.id:null;b=b.toString();var l=this.settings.search,m=l.ajax?l.ajax:!1,n=this._model.data,t=null,u=[],v=[],y;this._data.search.res.length&&!g&&this.clear_search();e===z&&(e=l.show_only_matches);k===z&&(k=l.show_only_matches_children);if(!c&&!1!==m){if(f.vakata.is_function(m))return m.call(this,b,function(p){p&&p.d&&(p=p.d);this._load_nodes(f.vakata.is_array(p)?
f.vakata.array_unique(p):[],function(){this.search(b,!0,e,h,g,k)})}.bind(this),h);m=f.extend({},m);m.data||(m.data={});m.data.str=b;h&&(m.data.inside=h);this._data.search.lastRequest&&this._data.search.lastRequest.abort();this._data.search.lastRequest=f.ajax(m).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(m)};this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(p){p&&
p.d&&(p=p.d);this._load_nodes(f.vakata.is_array(p)?f.vakata.array_unique(p):[],function(){this.search(b,!0,e,h,g,k)})}.bind(this));return this._data.search.lastRequest}g||(this._data.search.str=b,this._data.search.dom=f(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=k);t=new f.vakata.search(b,!0,{caseSensitive:l.case_sensitive,fuzzy:l.fuzzy});f.each(n[h?h:f.jstree.root].children_d,function(p,D){p=n[D];p.text&&!p.state.hidden&&(!l.search_leaves_only||
p.state.loaded&&0===p.children.length)&&(l.search_callback&&l.search_callback.call(this,b,p)||!l.search_callback&&t.search(p.text).isMatch)&&(u.push(D),v=v.concat(p.parents))});if(u.length){v=f.vakata.array_unique(v);c=0;for(y=v.length;c<y;c++)v[c]!==f.jstree.root&&n[v[c]]&&!0===this.open_node(v[c],null,0)&&this._data.search.opn.push(v[c]);g?(this._data.search.dom=this._data.search.dom.add(f(this.element[0].querySelectorAll("#"+f.map(u,function(p){return-1!=="0123456789".indexOf(p[0])?"\\3"+p[0]+
" "+p.substr(1).replace(f.jstree.idregex,"\\$&"):p.replace(f.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=f.vakata.array_unique(this._data.search.res.concat(u))):(this._data.search.dom=f(this.element[0].querySelectorAll("#"+f.map(u,function(p){return-1!=="0123456789".indexOf(p[0])?"\\3"+p[0]+" "+p.substr(1).replace(f.jstree.idregex,"\\$&"):p.replace(f.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=u);this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",
{nodes:this._data.search.dom,str:b,res:this._data.search.res,show_only_matches:e})};this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.res.length&&(this._data.search.dom=f(this.element[0].querySelectorAll("#"+f.map(this._data.search.res,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(f.jstree.idregex,
"\\$&"):b.replace(f.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"));this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=f()};this.redraw_node=function(b,c,e,h){if((b=d.redraw_node.apply(this,arguments))&&-1!==f.inArray(b.id,this._data.search.res)){var g,k=null;var l=0;for(g=b.childNodes.length;l<g;l++)if(b.childNodes[l]&&b.childNodes[l].className&&-1!==b.childNodes[l].className.indexOf("jstree-anchor")){k=
b.childNodes[l];break}k&&(k.className+=" jstree-search")}return b}};(function(a){a.vakata.search=function(d,b,c){c=c||{};c=a.extend({},a.vakata.search.defaults,c);!1!==c.fuzzy&&(c.fuzzy=!0);d=c.caseSensitive?d:d.toLowerCase();var e=c.location,h=c.distance,g=c.threshold,k=d.length;32<k&&(c.fuzzy=!1);if(c.fuzzy){var l=1<<k-1;var m=function(){var u={},v;for(v=0;v<k;v++)u[d.charAt(v)]=0;for(v=0;v<k;v++)u[d.charAt(v)]|=1<<k-v-1;return u}();var n=function(u,v){u/=k;v=Math.abs(e-v);return h?u+v/h:v?1:u}}var t=
function(u){u=c.caseSensitive?u:u.toLowerCase();if(d===u||-1!==u.indexOf(d))return{isMatch:!0,score:0};if(!c.fuzzy)return{isMatch:!1,score:1};var v,y=u.length,p=g,D=u.indexOf(d,e),K,T=k+y,L=1,R=[];-1!==D&&(p=Math.min(n(0,D),p),D=u.lastIndexOf(d,e+k),-1!==D&&(p=Math.min(n(0,D),p)));D=-1;for(v=0;v<k;v++){var O=0;for(K=T;O<K;)n(v,e+K)<=p?O=K:T=K,K=Math.floor((T-O)/2+O);T=K;O=Math.max(1,e-K+1);var P=Math.min(e+K,y)+k;K=Array(P+2);for(K[P+1]=(1<<v)-1;P>=O;P--){var X=m[u.charAt(P-1)];K[P]=0===v?(K[P+1]<<
1|1)&X:(K[P+1]<<1|1)&X|(J[P+1]|J[P])<<1|1|J[P+1];if(K[P]&l&&(L=n(v,P-1),L<=p))if(p=L,D=P-1,R.push(D),D>e)O=Math.max(1,2*e-D);else break}if(n(v+1,e)>p)break;var J=K}return{isMatch:0<=D,score:L}};return!0===b?{search:t}:t(b)};a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}})(f);f.jstree.defaults.sort=function(a,d){return this.get_text(a)>this.get_text(d)?1:-1};f.jstree.plugins.sort=function(a,d){this.bind=function(){d.bind.call(this);this.element.on("model.jstree",
function(b,c){this.sort(c.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(b,c){this.sort(c.parent||c.node.parent,!1);this.redraw_node(c.parent||c.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(b,c){this.sort(c.parent,!1);this.redraw_node(c.parent,!0)}.bind(this))};this.sort=function(b,c){var e;if((b=this.get_node(b))&&b.children&&b.children.length&&(b.children.sort(this.settings.sort.bind(this)),c))for(c=0,e=b.children_d.length;c<e;c++)this.sort(b.children_d[c],
!1)}};var S=!1;f.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1};f.jstree.plugins.state=function(a,d){this.bind=function(){d.bind.call(this);var b=function(){this.element.on(this.settings.state.events,function(){S&&clearTimeout(S);S=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this));this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(c,
e){this.element.one("restore_state.jstree",b);this.restore_state()||b()}.bind(this))};this.save_state=function(){var b=this.get_state();this.settings.state.preserve_loaded||delete b.core.loaded;f.vakata.storage.set(this.settings.state.key,JSON.stringify({state:b,ttl:this.settings.state.ttl,sec:+new Date}))};this.restore_state=function(){var b=f.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}if(b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl)return!1;b&&b.state&&(b=b.state);
b&&f.vakata.is_function(this.settings.state.filter)&&(b=this.settings.state.filter.call(this,b));return b?(this.settings.state.preserve_loaded||delete b.core.loaded,this.element.one("set_state.jstree",function(c,e){e.instance.trigger("restore_state",{state:f.extend(!0,{},b)})}),this.set_state(b),!0):!1};this.clear_state=function(){return f.vakata.storage.del(this.settings.state.key)}};(function(a,d){a.vakata.storage={set:function(b,c){return window.localStorage.setItem(b,c)},get:function(b){return window.localStorage.getItem(b)},
del:function(b){return window.localStorage.removeItem(b)}}})(f);f.jstree.defaults.types={"default":{}};f.jstree.defaults.types[f.jstree.root]={};f.jstree.plugins.types=function(a,d){this.init=function(b,c){var e,h;if(c&&c.types&&c.types["default"])for(e in c.types)if("default"!==e&&e!==f.jstree.root&&c.types.hasOwnProperty(e))for(h in c.types["default"])c.types["default"].hasOwnProperty(h)&&c.types[e][h]===z&&(c.types[e][h]=c.types["default"][h]);d.init.call(this,b,c);this._model.data[f.jstree.root].type=
f.jstree.root};this.refresh=function(b,c){d.refresh.call(this,b,c);this._model.data[f.jstree.root].type=f.jstree.root};this.bind=function(){this.element.on("model.jstree",function(b,c){b=this._model.data;c=c.nodes;var e=this.settings.types,h,g;var k=0;for(h=c.length;k<h;k++){var l="default";b[c[k]].original&&b[c[k]].original.type&&e[b[c[k]].original.type]&&(l=b[c[k]].original.type);b[c[k]].data&&b[c[k]].data.jstree&&b[c[k]].data.jstree.type&&e[b[c[k]].data.jstree.type]&&(l=b[c[k]].data.jstree.type);
b[c[k]].type=l;!0===b[c[k]].icon&&e[l].icon!==z&&(b[c[k]].icon=e[l].icon);if(e[l].li_attr!==z&&"object"===typeof e[l].li_attr)for(g in e[l].li_attr)e[l].li_attr.hasOwnProperty(g)&&"id"!==g&&(b[c[k]].li_attr[g]===z?b[c[k]].li_attr[g]=e[l].li_attr[g]:"class"===g&&(b[c[k]].li_attr["class"]=e[l].li_attr["class"]+" "+b[c[k]].li_attr["class"]));if(e[l].a_attr!==z&&"object"===typeof e[l].a_attr)for(g in e[l].a_attr)e[l].a_attr.hasOwnProperty(g)&&"id"!==g&&(b[c[k]].a_attr[g]===z?b[c[k]].a_attr[g]=e[l].a_attr[g]:
"href"===g&&"#"===b[c[k]].a_attr[g]?b[c[k]].a_attr.href=e[l].a_attr.href:"class"===g&&(b[c[k]].a_attr["class"]=e[l].a_attr["class"]+" "+b[c[k]].a_attr["class"]))}b[f.jstree.root].type=f.jstree.root}.bind(this));d.bind.call(this)};this.get_json=function(b,c,e){var h=this._model.data,g=c?f.extend(!0,{},c,{no_id:!1}):{};g=d.get_json.call(this,b,g,e);if(!1===g)return!1;if(f.vakata.is_array(g))for(b=0,e=g.length;b<e;b++)g[b].type=g[b].id&&h[g[b].id]&&h[g[b].id].type?h[g[b].id].type:"default",c&&c.no_id&&
(delete g[b].id,g[b].li_attr&&g[b].li_attr.id&&delete g[b].li_attr.id,g[b].a_attr&&g[b].a_attr.id&&delete g[b].a_attr.id);else g.type=g.id&&h[g.id]&&h[g.id].type?h[g.id].type:"default",c&&c.no_id&&(g=this._delete_ids(g));return g};this._delete_ids=function(b){if(f.vakata.is_array(b)){for(var c=0,e=b.length;c<e;c++)b[c]=this._delete_ids(b[c]);return b}delete b.id;b.li_attr&&b.li_attr.id&&delete b.li_attr.id;b.a_attr&&b.a_attr.id&&delete b.a_attr.id;b.children&&f.vakata.is_array(b.children)&&(b.children=
this._delete_ids(b.children));return b};this.check=function(b,c,e,h,g){if(!1===d.check.call(this,b,c,e,h,g))return!1;c=c&&c.id?c:this.get_node(c);e=e&&e.id?e:this.get_node(e);g=c&&c.id?g&&g.origin?g.origin:f.jstree.reference(c.id):null;var k,l;g=g&&g._model&&g._model.data?g._model.data:null;switch(b){case "create_node":case "move_node":case "copy_node":if("move_node"!==b||-1===f.inArray(c.id,e.children)){var m=this.get_rules(e);if(m.max_children!==z&&-1!==m.max_children&&m.max_children===e.children.length)return this._data.core.last_error=
{error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})},!1;if(m.valid_children!==z&&-1!==m.valid_children&&-1===f.inArray(c.type||"default",m.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})},!1;if(g&&c.children_d&&c.parents){var n=
k=0;for(l=c.children_d.length;n<l;n++)k=Math.max(k,g[c.children_d[n]].parents.length);k=k-c.parents.length+1}if(0>=k||k===z)k=1;do{if(m.max_depth!==z&&-1!==m.max_depth&&m.max_depth<k)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})},!1;e=this.get_node(e.parent);m=this.get_rules(e);k++}while(e)}}return!0};this.get_rules=function(b){b=this.get_node(b);if(!b)return!1;
b=this.get_type(b,!0);b.max_depth===z&&(b.max_depth=-1);b.max_children===z&&(b.max_children=-1);b.valid_children===z&&(b.valid_children=-1);return b};this.get_type=function(b,c){return(b=this.get_node(b))?c?f.extend({type:b.type},this.settings.types[b.type]):b.type:!1};this.set_type=function(b,c){var e=this._model.data,h,g,k,l;if(f.vakata.is_array(b)){b=b.slice();e=0;for(h=b.length;e<h;e++)this.set_type(b[e],c);return!0}h=this.settings.types;b=this.get_node(b);if(!h[c]||!b)return!1;(k=this.get_node(b,
!0))&&k.length&&(l=k.children(".jstree-anchor"));var m=b.type;var n=this.get_icon(b);b.type=c;(!0===n||!h[m]||h[m].icon!==z&&n===h[m].icon)&&this.set_icon(b,h[c].icon!==z?h[c].icon:!0);if(h[m]&&h[m].li_attr!==z&&"object"===typeof h[m].li_attr)for(g in h[m].li_attr)h[m].li_attr.hasOwnProperty(g)&&"id"!==g&&("class"===g?(e[b.id].li_attr["class"]=(e[b.id].li_attr["class"]||"").replace(h[m].li_attr[g],""),k&&k.removeClass(h[m].li_attr[g])):e[b.id].li_attr[g]===h[m].li_attr[g]&&(e[b.id].li_attr[g]=null,
k&&k.removeAttr(g)));if(h[m]&&h[m].a_attr!==z&&"object"===typeof h[m].a_attr)for(g in h[m].a_attr)h[m].a_attr.hasOwnProperty(g)&&"id"!==g&&("class"===g?(e[b.id].a_attr["class"]=(e[b.id].a_attr["class"]||"").replace(h[m].a_attr[g],""),l&&l.removeClass(h[m].a_attr[g])):e[b.id].a_attr[g]===h[m].a_attr[g]&&("href"===g?(e[b.id].a_attr[g]="#",l&&l.attr("href","#")):(delete e[b.id].a_attr[g],l&&l.removeAttr(g))));if(h[c].li_attr!==z&&"object"===typeof h[c].li_attr)for(g in h[c].li_attr)h[c].li_attr.hasOwnProperty(g)&&
"id"!==g&&(e[b.id].li_attr[g]===z?(e[b.id].li_attr[g]=h[c].li_attr[g],k&&("class"===g?k.addClass(h[c].li_attr[g]):k.attr(g,h[c].li_attr[g]))):"class"===g&&(e[b.id].li_attr["class"]=h[c].li_attr[g]+" "+e[b.id].li_attr["class"],k&&k.addClass(h[c].li_attr[g])));if(h[c].a_attr!==z&&"object"===typeof h[c].a_attr)for(g in h[c].a_attr)h[c].a_attr.hasOwnProperty(g)&&"id"!==g&&(e[b.id].a_attr[g]===z?(e[b.id].a_attr[g]=h[c].a_attr[g],l&&("class"===g?l.addClass(h[c].a_attr[g]):l.attr(g,h[c].a_attr[g]))):"href"===
g&&"#"===e[b.id].a_attr[g]?(e[b.id].a_attr.href=h[c].a_attr.href,l&&l.attr("href",h[c].a_attr.href)):"class"===g&&(e[b.id].a_attr["class"]=h[c].a_attr["class"]+" "+e[b.id].a_attr["class"],l&&l.addClass(h[c].a_attr[g])));return!0}};f.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(a,d){return a+" ("+d+")"}};f.jstree.plugins.unique=function(a,d){this.check=function(b,c,e,h,g){if(!1===d.check.call(this,b,c,e,h,g))return!1;c=c&&c.id?c:this.get_node(c);e=e&&e.id?e:this.get_node(e);
if(!e||!e.children)return!0;var k="rename_node"===b?h:c.text,l=[],m=this.settings.unique.case_sensitive,n=this.settings.unique.trim_whitespace,t=this._model.data,u;var v=0;for(u=e.children.length;v<u;v++){var y=t[e.children[v]].text;m||(y=y.toLowerCase());n&&(y=y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));l.push(y)}m||(k=k.toLowerCase());n&&(k=k.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));switch(b){case "rename_node":return y=c.text||"",m||(y=y.toLowerCase()),n&&(y=y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
"")),v=-1===f.inArray(k,l)||c.text&&y===k,v||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+k+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),v;case "create_node":return v=-1===f.inArray(k,l),v||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+k+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&
e.id?e.id:!1})}),v;case "copy_node":return v=-1===f.inArray(k,l),v||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+k+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),v;case "move_node":return v=c.parent===e.id&&(!g||!g.is_multi)||-1===f.inArray(k,l),v||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+k+" already exists. Preventing: "+
b,data:JSON.stringify({chk:b,pos:h,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),v}return!0};this.create_node=function(b,c,e,h,g){if(!c||c.text===z){null===b&&(b=f.jstree.root);b=this.get_node(b);if(!b)return d.create_node.call(this,b,c,e,h,g);e=e===z?"last":e;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(b))return d.create_node.call(this,b,c,e,h,g);c||(c={});var k,l,m=this._model.data,n=this.settings.unique.case_sensitive,t=this.settings.unique.trim_whitespace,u=this.settings.unique.duplicate;
var v=k=this.get_string("New node");var y=[];var p=0;for(l=b.children.length;p<l;p++){var D=m[b.children[p]].text;n||(D=D.toLowerCase());t&&(D=D.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));y.push(D)}p=1;D=v;n||(D=D.toLowerCase());for(t&&(D=D.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==f.inArray(D,y);)D=v=u.call(this,k,++p).toString(),n||(D=D.toLowerCase()),t&&(D=D.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));c.text=v}return d.create_node.call(this,b,c,e,h,g)}};var V=x.createElement("DIV");
V.setAttribute("unselectable","on");V.setAttribute("role","presentation");V.className="jstree-wholerow";V.innerHTML="&#160;";f.jstree.plugins.wholerow=function(a,d){this.bind=function(){d.bind.call(this);this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(b,c){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",
function(b,c){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var e;var h=0;for(e=c.selected.length;h<e;h++)(b=this.get_node(c.selected[h],!0))&&b.length&&b.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(b,c){this.get_node(c.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(b,c){if("hover_node"!==
b.type||!this.is_disabled(c.node))this.get_node(c.node,!0).children(".jstree-wholerow")["hover_node"===b.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(b){if(this._data.contextmenu){b.preventDefault();var c=f.Event("contextmenu",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY});f(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c)}}.bind(this)).on("click.jstree",
".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=f.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});f(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}).on("dblclick.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=f.Event("dblclick",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});f(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}).on("click.jstree",
".jstree-leaf > .jstree-ocl",function(b){b.stopImmediatePropagation();var c=f.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});f(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(b){b.stopImmediatePropagation();this.is_disabled(b.currentTarget)||this.hover_node(b.currentTarget);return!1}.bind(this)).on("mouseleave.jstree",".jstree-node",
function(b){this.dehover_node(b.currentTarget)}.bind(this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();d.teardown.call(this)};this.redraw_node=function(b,c,e,h){if(b=d.redraw_node.apply(this,arguments)){var g=V.cloneNode(!0);-1!==f.inArray(b.id,this._data.core.selected)&&(g.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===b.id&&(g.className+=" jstree-wholerow-hovered");b.insertBefore(g,b.childNodes[0])}return b}};
if(window.customElements&&Object&&Object.create){B=Object.create(HTMLElement.prototype);B.createdCallback=function(){var a={core:{},plugins:[]},d;for(d in f.jstree.plugins)f.jstree.plugins.hasOwnProperty(d)&&this.attributes[d]&&(a.plugins.push(d),this.getAttribute(d)&&JSON.parse(this.getAttribute(d))&&(a[d]=JSON.parse(this.getAttribute(d))));for(d in f.jstree.defaults.core)f.jstree.defaults.core.hasOwnProperty(d)&&this.attributes[d]&&(a.core[d]=JSON.parse(this.getAttribute(d))||this.getAttribute(d));
f(this).jstree(a)};try{window.customElements.define("vakata-jstree",function(){},{prototype:B})}catch(a){}}}});
(function(f,z){var F=0;f.widget("s3.hierarchicalopts",{options:{selected:null,multiple:!0,leafonly:!0,cascade:!1,bulkSelect:!1,cascadeOptionInTree:!0,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",selectAllText:"Select All",deselectAllText:"Deselect All",icons:!1,sep:null,stripes:!0,htmlTitles:!0},_create:function(){var q=f(this.element),r=this.options;this.id=F;F+=1;this._namespace=".hierarchicalopts"+F;this.treeID=q.attr("id")+"-tree";this.input=q.find(".s3-hierarchy-input").first();
this.input.data("input",!0);var A=r.selected;A&&this.input.val(this._stringifySelection(A));this.button=f('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');this.buttonText=f("<span>"+r.noneSelectedText+"</span>").appendTo(this.button);this.noopts=f('<span class="no-options-available">'+r.noOptionsText+"</span>").hide();this.tree=q.find(".s3-hierarchy-tree").first();this.wrapper=this.tree.closest(".s3-hierarchy-wrapper").hide().before(this.noopts).before(this.button).detach().appendTo("body");
this.manualCascadeOption=this._isBulk=this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){f.Widget.prototype.destroy.call(this);this._unbindEvents();f(this.button).remove();f(this.noopts).remove();f(this.tree).detach().appendTo(this.element).show()},refresh:function(){this._unbindEvents();var q=this.options,r=this.tree,A=this;if(r.find("li").length){this.noopts.hide();this.button.attr("style","");this.input.next(".error_wrapper").insertAfter(this.button).one("click",function(){f(this).fadeOut()});
var w=this.input.val();if(w){w=this._parseSelection(w);var B=this.treeID;f.each(w,function(){f("#"+B+"-"+this).data("jstree",{selected:!0})})}w=r.find("> ul > li");if(1==w.length){w=w.first();var x=w.data("jstree");w.data("jstree",f.extend({},x,{opened:!0}))}w=q.multiple;x=q.leafonly;var G=q.cascade,M=!1,I=null,N=["sort","checkbox"];this.input.data("multiple",w);(G||x)&&w?M=!0:w&&(q.cascadeOptionInTree?this.manualCascadeOption=!0:(I=function(S){return r.jstree("is_parent",S)?(f.vakata.context.settings.icons=
!1,{select_all:{label:A.options.selectAllText,icon:!1,action:function(V){A._selectBranch(S)}},deselect_all:{label:A.options.deselectAllText,icon:!1,action:function(V){A._deselectBranch(S)}}}):null},N.push("contextmenu")));r.jstree({core:{themes:{icons:q.icons,stripes:q.stripes},animation:100,multiple:w,check_callback:!0},checkbox:{three_state:M},sort:function(S,V){var a=this.get_text(S)>this.get_text(V)?1:-1;try{var d=this.get_node(S).li_attr.rel}catch(c){d=null}try{var b=this.get_node(V).li_attr.rel}catch(c){b=
null}return"bulk"==d?-1:"bulk"==b?1:"none"==d?-1:"none"==b?1:a},contextmenu:{items:I,select_node:!1,icons:!1},plugins:N});var Q=jQuery.jstree.reference(r);w&&((q.bulkSelect||this.manualCascadeOption)&&q.cascadeOptionInTree?(this.wrapper.find(".s3-hierarchy-header").hide(),Q.create_node("#",{id:this.treeID+"-select-all",text:q.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first")):this.wrapper.find(".s3-hierarchy-header").removeClass("hide").show());r.on("ready.jstree",function(){var S=
Q.get_checked();A._updateButtonText(S)});this._bindEvents()}else this.button.attr("style","display:none!important"),this.noopts.show()},reload:function(q){var r=this;q=q.includes("?")?q+("&widget_id="+f(this.element).attr("id")):q+("?widget_id="+f(this.element).attr("id"));this.tree.jstree("destroy");this.input.val("");f.getS3(q,function(A){r.tree.html(A);r.refresh()},"html")},_setOption:function(q,r){if("selected"===q){var A=jQuery.jstree.reference(f(this.tree));if(A&&(A.uncheck_all(),r)){this.input.val(this._stringifySelection(r));
var w=this.treeID;f.each(r,function(){A.check_node("#"+w+"-"+this)});this._updateButtonText(r)}}this._super(q,r)},_updateSelectedNodes:function(){var q=jQuery.jstree.reference(f(this.tree)),r=this._parseSelection(this.input.val()),A=[],w=[],B=this.options.leafonly,x=q.get_checked(!0);f(x).each(function(){var M=f(this).attr("id");if("bulk"!=f(this).attr("rel")&&M&&(!B||q.is_leaf(this))){var I=M.split("-").pop();"None"!=I&&(I=parseInt(I));I&&(A.push(I),w.push(M))}});x=!1;var G=f(A).not(r).get();G.length?
x=!0:(G=f(r).not(A).get(),G.length&&(x=!0));r=this.input.val(this._stringifySelection(A));this._updateButtonText(w);x&&(r.change(),f(this.element).trigger("select.s3hierarchy"));return!0},_updateButtonText:function(q){var r=this.options,A=0;q&&(A=q.length);if(A)if(1<A)q=r.selectedText.replace("#",A);else{for(var w=jQuery.jstree.reference(f(this.tree)),B=[],x,G,M=r.sep,I=0;I<A;I++){if(M)for(G=q[I],x=f("#"+G+" > a").text().replace(/^\s+|\s+$/g,""),G=w.get_parent(G);"#"!=G;)x=f("#"+G+" > a").text().replace(/^\s+|\s+$/g,
"")+M+x,G=w.get_parent(G);else x=f("#"+q[I]+" > a").text().replace(/^\s+|\s+$/g,"");B.push(x)}q=B.length?B.join(" "):r.noneSelectedText}else q=r.noneSelectedText;this.buttonText.text(q)},_updateAndClose:function(){if(!this._isBulk){this._updateSelectedNodes();var q=this.wrapper,r=this;if(r.options.multiple)q.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",function(){window.setTimeout(function(){r.closeMenu()},100)});else window.setTimeout(function(){r.closeMenu()},100)}},_selectNode:function(q){var r=
this.options,A=jQuery.jstree.reference(f(this.tree)),w=r.multiple,B=r.leafonly;if(w)this._isBulk||"bulk"!=q.li_attr.rel||((r=A.get_parent(q))&&"#"!=r?(r=A.get_node(r),this._selectBranch(r,!0)):A.select_all());else{var x=q.id;f(A.get_checked(!0)).each(function(){x==this.id||B&&!A.is_leaf(this)||A.uncheck_node(this)})}if(B&&!w&&!A.is_leaf(q))return A.deselect_node(q),!1;this._updateAndClose()},_deselectNode:function(q){var r=jQuery.jstree.reference(f(this.tree));if(!this._isBulk){if("bulk"==q.li_attr.rel)(q=
r.get_parent(q))&&"#"!=q?(q=r.get_node(q),this._deselectBranch(q,!0)):r.deselect_all();else if(q=r.get_parent(q))if(q=r.get_node(q+"-select-all"))this._isBulk=!0,r.uncheck_node(q),this._isBulk=!1;if(q=r.get_node(this.treeID+"-select-all"))this._isBulk=!0,r.uncheck_node(q),this._isBulk=!1}this._updateSelectedNodes()},_openNode:function(q){var r=jQuery.jstree.reference(f(this.tree)),A=r.get_parent(q);A.length&&r.open_node(A,!1,!0);if(this.manualCascadeOption){var w=q.id;A=r.get_node(w+"-select-all");
A||(q=r.create_node(q,{id:w+"-select-all",text:this.options.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first"),A=r.get_node(q));(q=r.get_node(this.treeID+"-select-all"))&&r.is_checked(q)&&(this._isBulk=!0,r.check_node(A),this._isBulk=!1)}},_selectBranch:function(q,r){var A=jQuery.jstree.reference(f(this.tree)),w=this;this._isBulk=!0;A.open_node(q,function(){var B=A.get_children_dom(q);f(B).each(function(){w._selectBranch(this)});r||A.check_node(q)});this._isBulk=!1;this._updateAndClose()},
_deselectBranch:function(q,r){var A=jQuery.jstree.reference(f(this.tree)),w=this;this._isBulk=!0;A.open_node(q,function(){var B=A.get_children_dom(q);f(B).each(function(){w._deselectBranch(this)});r||A.uncheck_node(q)});this._isBulk=!1;this._updateSelectedNodes()},set:function(q){var r=jQuery.jstree.reference(f(this.tree)),A=this.treeID;this._isBulk=!0;r.uncheck_all();r.close_all();if(q){var w=function(B,x){if(B=r.get_parent(B))"#"!=B?(w(B),r.open_node(B,x)):x&&x()};q.forEach(function(B){var x=r.get_node(A+
"-"+B);x&&w(x,function(){r.check_node(x)})})}this._isBulk=!1;this._updateSelectedNodes()},get:function(){return this._parseSelection(this.input.val())},reset:function(){var q=jQuery.jstree.reference(f(this.tree));this._isBulk=!0;q.uncheck_all();q.close_all();this._isBulk=!1;this._updateSelectedNodes();return!0},_setMenuPosition:function(q,r){var A=r.offset(),w={position:"absolute",top:A.top+r.outerHeight(),minWidth:r.outerWidth()-8};"rtl"===f("body").css("direction")?w.right=f(window).width()-(A.left+
r.outerWidth()):w.left=A.left;q.css(w)},openMenu:function(){this._isOpen&&this.closeMenu();var q=f(this.button),r=f(this.wrapper),A=this;this._setMenuPosition(r,q);f(window).on("resize"+this._namespace+"-mpos",function(){A._setMenuPosition(r,q)});r.show();f(this.tree).jstree("set_focus");this._isOpen=!0;q.addClass("ui-state-active");f(this).trigger("open")},closeMenu:function(){f(window).off(this._namespace+"-mpos");f(this.tree).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");
f(this.wrapper).fadeOut(50);this._isOpen=!1;f(this.button).removeClass("ui-state-active");f(this).trigger("close")},addNode:function(q,r,A,w){var B=this.tree,x=this.treeID;r=x+"-"+r;if(jQuery.jstree.reference(B)){var G="#";q&&(G=f("#"+x+"-"+q+"_anchor"),G.length||(G="#"));B.jstree("create_node",G,{id:r,text:A,li_attr:{rel:"leaf"}},"last");q&&(G.attr({rel:"parent"}),B.jstree("open_node",G))}else q='<li rel="leaf" class="s3-hierarchy-node" id="'+r+'">'+A+"</li>",f("#"+x).append(q),this.refresh();w&&
B.jstree("check_node",f("#"+r))},_parseSelection:function(q){if(q)q=JSON.parse(q);else return[];q?q.constructor!==Array&&(q=[q]):q=[];return q},_stringifySelection:function(q){if(!this.options.multiple)if(q.length)q=q[0];else return"";return JSON.stringify(q)},_bindEvents:function(){var q=this,r=f(this.wrapper),A=f(this.tree),w=f(this.button),B=this._namespace,x=this.options,G=jQuery.jstree.reference(A),M=f.vakata.context.settings.icons;f(document).bind("context_show.vakata",function(){r.unbind("mouseleave.hierarchicalopts");
f.vakata.context.settings.icons=M});A.bind("select_node.jstree",function(I,N){q._selectNode(N.node)}).bind("deselect_node.jstree",function(I,N){q._deselectNode(N.node)}).bind("open_node.jstree",function(I,N){q._openNode(N.node)});w.bind("click"+B,function(){q._isOpen?q.closeMenu():q.openMenu()}).bind("keyup"+B,function(I){I.preventDefault();switch(I.keyCode){case 27:case 38:case 37:q.closeMenu();break;case 39:case 40:q.openMenu()}}).bind("mouseenter"+B,function(){w.hasClass("ui-state-disabled")||
f(this).addClass("ui-state-hover")}).bind("mouseleave"+B,function(){f(this).removeClass("ui-state-hover")}).bind("focus"+B,function(){w.hasClass("ui-state-disabled")||f(this).addClass("ui-state-focus")}).bind("blur"+B,function(){f(this).removeClass("ui-state-focus")});x.multiple&&x.bulkSelect&&!x.cascadeOptionInTree&&(r.find(".s3-hierarchy-select-all").bind("click"+B,function(I){I.preventDefault();G.select_all();q._updateSelectedNodes()}),r.find(".s3-hierarchy-deselect-all").bind("click"+B,function(I){I.preventDefault();
G.deselect_all();q._updateSelectedNodes()}),r.find(".s3-hierarchy-header").bind("click"+B,function(I){I.preventDefault();I.stopPropagation()}).bind("mousedown"+B,function(I){I.preventDefault();I.stopPropagation()}));f(document).bind("mousedown"+B,function(I){var N=I.target;if(f(".jstree-contextmenu").has(N).length||3==I.which)return r.unbind("mouseleave.hierarchicalopts"),!0;A.is(N)||w.is(N)||0!==A.has(N).length||0!==w.has(N).length||q.closeMenu()});return!0},_unbindEvents:function(){var q=f(this.tree);
f(this.button);var r=this._namespace;q.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");f(this.button).unbind(r);f(document).unbind(r);return!0}})})(jQuery);
(function(f,z){var F=0;f.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,deleteRoot:!0,addTitle:"Add Record",addLabel:"Add",addURL:null,icons:!1,stripes:!0,htmlTitles:!0},_create:function(){this.treeID=f(this.element).attr("id")+"-tree";this.id=F;F+=1},_init:function(){this.tree=f(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){f.Widget.prototype.destroy.call(this)},
refresh:function(){var q=this.tree,r=this.options;this._unbindEvents();var A=q.find("> ul > li");if(1==A.length){A=A.first();var w=A.data("jstree");A.data("jstree",f.extend({},w,{opened:!0}))}var B=this;q.jstree({core:{themes:{icons:r.icons,stripes:r.stripes},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(x){var G=!0;"#"==q.jstree(!0).get_parent(x)&&(G=r.deleteRoot);var M={};r.openURL&&(M.open={label:r.openLabel,action:function(I){B._openNode(x)},separator_after:!0});r.editURL&&
(M.edit={label:r.editLabel,action:function(I){B._editNode(x)}});G&&r.deleteURL&&(M.delete={label:r.deleteLabel,separator_after:!0,action:function(I){B._deleteNode(x)}});r.addURL&&(M.add={label:r.addLabel,action:function(I){B._addNode(x)}});return M},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},reload:function(){var q=this.options.ajaxURL.replace("json","tree"),r=this;f.getS3(q,function(A){r.tree.html(A);r.refresh()},"html")},_openNode:function(q){var r=this.options.openURL;
q=q.id;r&&q&&(q=parseInt(q.split("-").pop()))&&(r=r.replace("[id]",q).replace("%5Bid%5D",q),window.location.href=r)},refreshNode:function(q){var r=this.options.ajaxURL,A=q.attr("id");if(r&&A&&(A=parseInt(A.split("-").pop()))){var w=this.tree,B=this.treeID;f.getJSONS3(r+"?node="+A,function(x){x.label&&w.jstree("rename_node",q,x.label);if(x=x.children){w.jstree("open_node",q,!1,!1);for(var G,M,I,N=0,Q=0,S=x.length;Q<S;Q++)G=x[Q],M=B+"-"+G.node,(I=w.jstree("get_node","#"+M,!0))?w.jstree("rename_node",
I,G.label):(w.jstree("create_node",q,{id:M,text:G.label,li_attr:{rel:"leaf"}}),N++);N&&(w.jstree("open_node",q),q.attr({rel:"parent"}))}})}},_editNode:function(q){var r=this.options.editURL;q=q.id;if(r&&q){var A=parseInt(q.split("-").pop());A&&(r=r.replace("[id]",A).replace("%5Bid%5D",A).split("?")[0],r+="?node="+q+"&hierarchy="+this.options.widgetID,q=S3.uid(),r=f('<iframe id="'+q+'" src='+r+" onload=\"S3.popup_loaded('"+q+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),
this._openPopup(r,this.options.editTitle))}},_addNode:function(q){var r=this.options.addURL;q=q.id;if(r&&q){var A=parseInt(q.split("-").pop());A&&(r=r.split("?")[0],r+="?node="+q+"&link_to_parent="+A+"&hierarchy="+this.options.widgetID,q=S3.uid(),r=f('<iframe id="'+q+'" src='+r+" onload=\"S3.popup_loaded('"+q+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(r,this.options.addTitle))}},_deleteNode:function(q){if(!confirm(i18n.delete_confirmation))return!1;
var r=this.options.deleteURL,A=q.id,w=this.tree;r&&A&&(A=parseInt(A.split("-").pop()))&&(r=r.replace("[id]",A).replace("%5Bid%5D",A).split("?")[0],f.ajaxS3({type:"POST",url:r+"?recursive=1",data:{},dataType:"JSON",success:function(B){w.jstree("delete_node",q)},error:function(B,x,G){x=B.responseText;if("{"==x[0])try{x=JSON.parse(B.responseText),S3.showAlert(x.message,"error")}catch(M){}}}))},_openPopup:function(q,r){q.dialog({close:function(A,w){if(self.parent){var B=self.parent.$("iframe.ui-dialog-content"),
x=B.width();B.width(0);window.setTimeout(function(){B.width(x)},300)}q.remove()},minHeight:480,modal:!0,open:function(A,w){f(".ui-widget-overlay").bind("click",function(){q.dialog("close")})},title:r,minWidth:320,closeText:""})},_bindEvents:function(){return!0},_unbindEvents:function(){this.tree.jstree("destroy","true");return!0}})})(jQuery);
