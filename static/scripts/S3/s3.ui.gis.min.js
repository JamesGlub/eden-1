var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,f,c){if(null==d)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,f,c){if(d==Array.prototype||d==Object.prototype)return d;d[f]=c.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<d.length;++f){var c=d[f];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,f){var c=$jscomp.propertyToPolyfillSymbol[f];if(null==c)return d[f];c=d[c];return void 0!==c?c:d[f]};$jscomp.polyfill=function(d,f,c,n){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,f,c,n):$jscomp.polyfillUnisolated(d,f,c,n))};
$jscomp.polyfillUnisolated=function(d,f,c,n){c=$jscomp.global;d=d.split(".");for(n=0;n<d.length-1;n++){var b=d[n];if(!(b in c))return;c=c[b]}d=d[d.length-1];n=c[d];f=f(n);f!=n&&null!=f&&$jscomp.defineProperty(c,d,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(d,f,c,n){var b=d.split(".");d=1===b.length;n=b[0];n=!d&&n in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var a=0;a<b.length-1;a++){var e=b[a];if(!(e in n))return;n=n[e]}b=b[b.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?n[b]:null;f=f(c);null!=f&&(d?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:f}):f!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+c+"$"+b),$jscomp.defineProperty(n,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("String.prototype.startsWith",function(d){return d?d:function(f,c){var n=$jscomp.checkStringArgs(this,f,"startsWith");f+="";var b=n.length,a=f.length;c=Math.max(0,Math.min(c|0,n.length));for(var e=0;e<a&&c<b;)if(n[c++]!=f[e++])return!1;return e>=a}},"es6","es3");
(function(d){d(window.jQuery,window._,window.ol)})(function(d,f,c){var n=0;d.widget("s3.showMap",{options:{id:"default_map",i18n:{loading:"Loading",requires_login:"Requires Login"},lat:0,lon:0,zoom:0},_create:function(){this.id=n;n+=1;this.eventNamespace=".s3Map";this.proxyHost=S3.Ap.concat("/gis/proxy?url=")},_init:function(b){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},refresh:function(){var b=this.options,a=this.addLayers();this.map=b=new c.Map({layers:a,target:b.id,
view:new c.View({center:c.proj.fromLonLat([b.lon,b.lat]),zoom:b.zoom})});this.tooltip=a=d("#"+this.options.id+" .s3-gis-tooltip");a=new c.Overlay({element:a[0],positioning:"bottom-center",stopEvent:!1,offset:[0,-15]});b.addOverlay(a);this.tooltip_ol=a;this._bindEvents(b)},addLayers:function(){var b=[],a=this.options,e=a.layers_osm;void 0!=e&&this.addLayersOSM(b,e);e=a.Bing;void 0!=e&&this.addLayersBing(b,e);this.addLayersGeoJSON(b,a);return b},addLayersOSM:function(b,a){for(var e,g,p,k,m,r=0;r<a.length;r++)g=
a[r],e=void 0!=g.attribution?[g.attribution]:[c.source.OSM.ATTRIBUTION],p=void 0!=g.maxZoom?g.maxZoom:19,k=void 0!=g.base?g.base:!0,m=void 0!=g.url?g.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",e={attributions:e,maxZoom:p,opaque:k,url:m},e=new c.layer.Tile({source:new c.source.OSM(e)}),void 0!=g._base?e.setVisible(g._base):e.setVisible(!1),b.push(e)},addLayersBing:function(b,a){for(var e=a.a,g,p=a.l,k=0;k<p.length;k++)g=p[k],a=new c.layer.Tile({source:new c.source.BingMaps({key:e,imagerySet:g.t,
name:g.n,s3_layer_id:g.i,s3_layer_type:"bing"})}),void 0!=g.b?a.setVisible(!0):a.setVisible(!1),b.push(a)},addLayersGeoJSON:function(b,a){var e=a.layers_feature||[],g=a.layers_geojson||[];var p=a.layers_georss||[];var k=a.layers_shapefile||[];var m=a.layers_theme||[],r=this.proxyHost;e=(a.feature_queries||[]).concat(a.feature_resources||[]).concat(e).concat(g).concat(p).concat(k).concat(m);for(g=0;g<e.length;g++)a=e[g],k=void 0!=a.projection?new c.format.GeoJSON({dataProjection:"EPSG:"+a.projection}):
new c.format.GeoJSON({dataProjection:"EPSG:4326"}),p=this.layerStyle(a),m=a.url,m.startsWith("http")&&(m=r.concat(m)),k=new c.source.Vector({url:m,format:k}),k=new c.layer.Vector({source:k,style:p}),void 0!=a.dir&&(k.dir=a.dir),void 0!=a.popup_format&&(k.s3_popup_format=a.popup_format),p=void 0!=a.type?a.type:"feature",k.s3_layer_type=p,void 0!=a.visibility&&k.setVisible(a.visibility),b.push(k)},layerStyle:function(b){if(void 0!==b.marker)b=new c.style.Style({image:new c.style.Icon({src:S3.Ap.concat("/static/img/markers/"+
b.marker.i)})});else if(void 0!==b.marker)b=b.style;else{b=new c.style.Fill({color:"rgba(255,255,255,0.4)"});var a=new c.style.Stroke({color:"#3399CC",width:1.25}),e=new c.style.Icon({src:S3.Ap.concat("/static/img/markers/"+this.options.marker)}),g={Point:new c.style.Style({image:e}),LineString:new c.style.Style({stroke:a}),MultiLineString:new c.style.Style({stroke:a}),MultiPoint:new c.style.Style({image:e}),MultiPolygon:new c.style.Style({stroke:a,fill:b}),Polygon:new c.style.Style({stroke:a,fill:b}),
GeometryCollection:new c.style.Style({stroke:a,fill:b,image:e}),Circle:new c.style.Style({stroke:a,fill:b})};b=function(p){return g[p.getGeometry().getType()]}}return b},addPopup:function(b,a,e,g,p){var k=this.map;a=this.id+"_"+a.ol_uid+"_"+b.get("id")+"_popup";p&&e?(0===e.indexOf("http")&&(e=this.proxyHost+encodeURIComponent(e)),g='<iframe src="'+e+'" onload="S3.gis.popupLoaded(\''+a+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>'):void 0==g&&(g=this.options.i18n.loading+
'...<div class="throbber"></div>');d("#"+this.options.id).append('<div id="'+a+'" class="s3-gis-popup"><div class="s3-gis-popup-close"></div><div class="s3-gis-popup-content"></div></div>');var m=d("#"+a),r=new c.Overlay({element:m[0],positioning:"bottom-center",offset:[0,-12]});k.addOverlay(r);b=b.getGeometry().getCoordinates();r.setPosition(b);d("#"+a+" .s3-gis-popup-content").html(g);m.show();d("#"+a+" .s3-gis-popup-close").on("click",{id:a,map:k,overlay:r},this.removePopup);p||void 0==e||this._loadDetails(e,
a,m)},removePopup:function(b){b.data.map.removeOverlay(b.data.overlay);d("#"+b.data.id).remove();b.preventDefault()},_loadDetails:function(b,a,e){var g=this;0===b.indexOf("http")&&(b=this.proxyHost+encodeURIComponent(b));d.ajaxS3({url:b,dataType:"html",success:function(p){try{d("#"+a+" .s3-gis-popup-content").html(p),d("#"+a+" a.btn.iframe").click(function(){var k=d(this).attr("href");0===k.indexOf("http://")&&(k=g.proxyHost+encodeURIComponent(k));k='<iframe src="'+k+'" onload="S3.gis.popupLoaded(\''+
a+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>';d("#"+a+" .s3-gis-popup-content").html(k);return!1})}catch(k){}},error:function(p,k,m){msg="UNAUTHORIZED"==m?g.options.i18n.requires_login:p.responseText;d("#"+a+" .s3-gis-popup-content").html(msg)}})},_deserialize:function(){},_bindEvents:function(b){var a=this,e,g,p,k,m,r,D,B,E,q,F,z,G;b.on("pointermove",function(h){if(h.dragging)a.tooltip.hide();else if(z=b.forEachFeatureAtPixel(h.pixel,function(l,t){return{feature:l,
layer:t}})){m=z.feature;q=z.layer;r=m.getGeometry();D=r.getType();if("Point"==D)p=r.getCoordinates();else if("Polygon"==D)p=r.getInteriorPoint().getCoordinates();else throw"No support yet for Popups other than for Points or Polygons!";a.tooltip_ol.setPosition(p);if(void 0!=q.s3_popup_format){f.templateSettings={interpolate:/\{(.+?)\}/g};F=q.s3_popup_format;G=f.template(F);e={};k={};E=F.split("{");for(h=0;h<E.length;h++)B=E[h].split("}")[0],e[B]=m.get(B),k[B]="";f.defaults(e,k);g=G(e)}else void 0!=
m.get("popup")?g=m.get("popup"):void 0!=m.get("name")?g=m.get("name"):void 0!=q.title&&(h=m.get(q.title),g="object"==typeof h?h.value:h);a.tooltip.html(g).show()}else a.tooltip.hide()});b.on("click",function(h){if(z=b.forEachFeatureAtPixel(h.pixel,function(x,u){return{feature:x,layer:u}})){a.tooltip.hide();m=z.feature;q=z.layer;var l=m.getProperties();h=q.s3_layer_type;if("kml"==h){h=void 0!=q.title?q.title:"name";if(void 0!=m.style.balloonStyle)var t=m.style.balloonStyle.replace(/{([^{}]*)}/g,function(x,
u){u=l[u];return"string"===typeof u||"number"===typeof u?u:x});else{var v=typeof l[h];h="object"==v?l[h].value:l[h];t="<h3>"+h+"</h3>";h=q.body.split(" ");for(var y,C,w=0;w<h.length;w++)v=typeof l[h[w]],"object"==v?(v=l[h[w]].displayName,""===v&&(v=h[w]),C=l[h[w]].value,y='<div class="gis_popup_row"><div class="gis_popup_label">'+v+':</div><div class="gis_popup_cell">'+C+"</div></div>"):y=void 0!=l[h[w]]?'<div class="gis_popup_row">'+l[h[w]]+"</div>":"",t+=y}-1!=t.search("<script")&&(t="Content contained Javascript! Escaped content below.<br />"+
t.replace(/</g,"<"))}else if("gpx"!=h)if("shapefile"==h||"geojson"==h)t="<div>",d.each(l,function(x,u){"id_orig"==x&&(x="id");y='<div class="gis_popup_row"><div class="gis_popup_label">'+x+':</div><div class="gis_popup_cell">'+u+"</div></div>";t+=y}),t+="</div>";else if("wfs"==h)h=void 0!=q.title?q.title:"name",h=l[h],t="<h3>"+h+"</h3>",d.each(l,function(x,u){y='<div class="gis_popup_row"><div class="gis_popup_label">'+x+':</div><div class="gis_popup_val">'+u+"</div></div>";t+=y});else if(void 0!=
l.url)var A=l.url;else if(void 0!=q.s3_url_format)f.templateSettings={interpolate:/\{(.+?)\}/g},A=f.template(q.s3_url_format),l.id.constructor===Array&&(l.id=l.id[0]),A=A(l);else{name=void 0==l.name?"":"<h3>"+l.name+"</h3>";h=void 0==l.description?"":"<p>"+l.description+"</p>";w=void 0==l.link?"":'<a href="'+l.link+'" target="_blank">'+l.link+"</a>";if(void 0==l.data)v="";else if(0===l.data.indexOf("http://")){var I=!0;var H=S3.uid();v='<div id="'+H+'">'+a.options.i18n.loading+"...<div class='throbber'></div></div>"}else v=
"<p>"+l.data+"</p>";C=void 0==l.image?"":0===l.image.indexOf("http://")?'<img src="'+l.image+'" height=300 width=300>':"";t=name+h+w+v+C}A=a.addPopup(m,q,A,t);I&&a._loadDetails(l.data,H,A)}})},_unbindEvents:function(){return!0}})});
